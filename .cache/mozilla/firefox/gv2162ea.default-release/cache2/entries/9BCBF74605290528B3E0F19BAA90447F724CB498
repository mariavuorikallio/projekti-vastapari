browzine.primo = (function() {
  var libraryId = browzine.libraryId;
  var api = libraryIdOverride(urlRewrite(browzine.api));
  var apiKey = browzine.apiKey;

  function urlRewrite(url) {
    if (!url) {
      return;
    } else if (url.indexOf("staging-api.thirdiron.com") > -1) {
      return url;
    }

    return url.indexOf("public-api.thirdiron.com") > -1 ? url : url.replace("api.thirdiron.com", "public-api.thirdiron.com");
  };

  function libraryIdOverride(url) {
    var override = url;
    var libraryId = browzine.libraryId;

    if (libraryId) {
      var baseUrl = "https://public-api.thirdiron.com/public/v1/libraries/{libraryId}";
      override = baseUrl.replace(/{libraryId}/g, libraryId);
    }

    return override;
  };

  function getResult(scope) {
    return scope.result || scope.item;
  };

  function isArticle(scope) {
    var validation = false;
    var result = getResult(scope);

    if (result && result.pnx) {
      if (result.pnx.display && result.pnx.display.type) {
        var contentType = result.pnx.display.type[0].trim().toLowerCase();

        if (contentType.indexOf("article") > -1) {
          validation = true;
        }
      }
    }

    return validation;
  };

  function isJournal(scope) {
    var validation = false;
    var result = getResult(scope);

    if (result && result.pnx) {
      if (result.pnx.display && result.pnx.display.type) {
        var contentType = result.pnx.display.type[0].trim().toLowerCase();

        if (contentType.indexOf("journal") > -1) {
          validation = true;
        }
      }
    }

    return validation;
  };

  function getIssn(scope) {
    var issn = "";
    var result = getResult(scope);

    if (result && result.pnx && result.pnx.addata) {
      if (result.pnx.addata.issn) {
        if (result.pnx.addata.issn.length > 1) {
          issn = result.pnx.addata.issn.filter(function(issn) {
            return (issn.length < 10) && (/[\S]{4}\-[\S]{4}/.test(issn));
          }).join(",").trim().replace(/-/g, "");
        } else {
          if (result.pnx.addata.issn[0]) {
            issn = result.pnx.addata.issn[0].trim().replace("-", "");
          }
        }
      }

      if (result.pnx.addata.eissn && !issn) {
        if (result.pnx.addata.eissn.length > 1) {
          issn = result.pnx.addata.eissn.filter(function(issn) {
            return (issn.length < 10) && (/[\S]{4}\-[\S]{4}/.test(issn));
          }).join(",").trim().replace(/-/g, "");
        } else {
          if (result.pnx.addata.eissn[0]) {
            issn = result.pnx.addata.eissn[0].trim().replace("-", "");
          }
        }
      }
    }

    return encodeURIComponent(issn);
  };

  function getDoi(scope) {
    var doi = "";
    var result = getResult(scope);

    if (result && result.pnx) {
      if (result.pnx.addata && result.pnx.addata.doi) {
        if (result.pnx.addata.doi[0]) {
          doi = result.pnx.addata.doi[0].trim();
        }
      }
    }

    return encodeURIComponent(doi);
  };

  function getEndpoint(scope) {
    var endpoint = "";

    if (isJournal(scope) && getIssn(scope)) {
      var issn = getIssn(scope);
      endpoint = api + "/search?issns=" + issn;
    }

    if (isArticle(scope) && getDoi(scope)) {
      var doi = getDoi(scope);
      endpoint = api + "/articles/doi/" + doi + "?include=journal,library";
    }

    if (isArticle(scope) && !getDoi(scope) && getIssn(scope)) {
      var issn = getIssn(scope);
      endpoint = api + "/search?issns=" + issn;
    }

    endpoint += "&access_token=" + apiKey;

    return endpoint;
  };

  function getUnpaywallEndpoint(scope) {
    var endpoint;
    var email = browzine.unpaywallEmailAddressKey;

    if (isArticle(scope) && getDoi(scope) && email) {
      var doi = getDoi(scope);
      endpoint = "https://api.unpaywall.org/v2/" + doi + "?email=" + email;
    }

    return endpoint;
  };

  function getData(response) {
    var data = {};

    if (Array.isArray(response.data)) {
      data = response.data.filter(function(journal) {
        return journal.browzineEnabled === true;
      }).pop();
    } else {
      data = response.data;
    }

    return data;
  };

  function getIncludedJournal(response) {
    var journal = null;

    if (response.included) {
      journal = Array.isArray(response.included) ? response.included[0] : response.included;
    }

    return journal;
  };

  function getBrowZineWebLink(data) {
    var browzineWebLink = null;

    if (data && data.browzineWebLink) {
      browzineWebLink = data.browzineWebLink;
    }

    return browzineWebLink;
  };

  function getCoverImageUrl(scope, data, journal) {
    var coverImageUrl = null;

    if (isJournal(scope) && getIssn(scope)) {
      if (data && data.coverImageUrl) {
        coverImageUrl = data.coverImageUrl;
      }
    }

    if (isArticle(scope) && getDoi(scope)) {
      if (journal && journal.coverImageUrl) {
        coverImageUrl = journal.coverImageUrl;
      }
    }

    if (isArticle(scope) && !getDoi(scope) && getIssn(scope)) {
      if (data && data.coverImageUrl) {
        coverImageUrl = data.coverImageUrl;
      }
    }

    return coverImageUrl;
  };

  function getBrowZineEnabled(scope, data, journal) {
    var browzineEnabled = false;

    if (isJournal(scope)) {
      if (data && data.browzineEnabled) {
        browzineEnabled = data.browzineEnabled;
      }
    }

    if (isArticle(scope)) {
      if (journal && journal.browzineEnabled) {
        browzineEnabled = journal.browzineEnabled;
      }
    }

    return browzineEnabled;
  };

  function isDefaultCoverImage(coverImageUrl) {
    var defaultCoverImage = false;

    if (coverImageUrl && coverImageUrl.toLowerCase().indexOf("default") > -1) {
      defaultCoverImage = true;
    }

    return defaultCoverImage;
  };

  function getDirectToPDFUrl(scope, data) {
    var directToPDFUrl = null;

    if (isArticle(scope)) {
      if (data && data.fullTextFile) {
        directToPDFUrl = data.fullTextFile;
      }
    }

    return directToPDFUrl;
  };

  function getUnpaywallUsable(scope, data) {
    if (!isArticle(scope)) {
      return false;
    }
    if (!data || !data.hasOwnProperty("unpaywallUsable")) {
      return true;
    }
    return !!data.unpaywallUsable;
  };

  function getArticleLinkUrl(scope, data) {
    var articleLinkUrl = null;

    if (isArticle(scope)) {
      if (data && data.contentLocation) {
        articleLinkUrl = data.contentLocation;
      }
    }

    return articleLinkUrl;
  };

  function getArticleRetractionUrl(scope, data) {
    var articleRetractionUrl = null;

    if (isArticle(scope)) {
      if (data && data.retractionNoticeUrl) {
        articleRetractionUrl = data.retractionNoticeUrl;
      }
    }

    return articleRetractionUrl;
  };

  function getArticleEOCNoticeUrl(scope, data) {
    var articleEocNoticeUrl = null;

    if (isArticle(scope)) {
      if (data && data.expressionOfConcernNoticeUrl) {
        articleEocNoticeUrl = data.expressionOfConcernNoticeUrl;
      }
    }
    return articleEocNoticeUrl;
  }

  function getProblematicJournalArticleNoticeUrl(scope, data) {
    var problematicJournalArticleNoticeUrl = null;

    if (isArticle(scope)) {
      if (data && data.problematicJournalArticleNoticeUrl) {
        problematicJournalArticleNoticeUrl = data.problematicJournalArticleNoticeUrl;
      }
    }
    return problematicJournalArticleNoticeUrl;
  }

  function isTrustedRepository(response) {
    var validation = false;

    if (response.best_oa_location && response.best_oa_location.url_for_pdf) {
      if (response.best_oa_location.url_for_pdf.indexOf('nih.gov') > -1 || response.best_oa_location.url_for_pdf.indexOf('europepmc.org') > -1) {
        validation = true;
      }
    }

    return validation;
  };

  function isUnknownVersion(response) {
    var validation = false;

    if (response.best_oa_location) {
      if (!response.best_oa_location.version || response.best_oa_location.version === '') {
        validation = true;
      }
    }

    return validation;
  };

  function getUnpaywallArticlePDFUrl(response) {
    var url;

    if (response.best_oa_location) {
      if (response.best_oa_location.host_type === "publisher" || response.best_oa_location.host_type === "repository") {
        if (response.best_oa_location.version === "publishedVersion" || (isUnknownVersion(response) && isTrustedRepository(response))) {
          if (response.best_oa_location.url_for_pdf) {
            url = response.best_oa_location.url_for_pdf;
          }
        }
      }
    }

    return url;
  };

  function getUnpaywallArticleLinkUrl(response) {
    var url;

    if (response.best_oa_location) {
      if (response.best_oa_location.host_type === "publisher" || response.best_oa_location.host_type === "repository") {
        if (response.best_oa_location.version === "publishedVersion") {
          if (!response.best_oa_location.url_for_pdf) {
            url = response.best_oa_location.url_for_landing_page;
          }
        }
      }
    }

    return url;
  };

  function getUnpaywallManuscriptArticlePDFUrl(response) {
    var url;

    if (response.best_oa_location) {
      if (response.best_oa_location.host_type === "repository") {
        if (response.best_oa_location.version === "acceptedVersion" || (isUnknownVersion(response) && !isTrustedRepository(response))) {
          if (response.best_oa_location.url_for_pdf) {
            url = response.best_oa_location.url_for_pdf;
          }
        }
      }
    }

    return url;
  };

  function getUnpaywallManuscriptArticleLinkUrl(response) {
    var url;

    if (response.best_oa_location) {
      if (response.best_oa_location.host_type === "repository") {
        if (response.best_oa_location.version === "acceptedVersion") {
          if (!response.best_oa_location.url_for_pdf) {
            url = response.best_oa_location.url_for_landing_page;
          }
        }
      }
    }

    return url;
  };

  function showJournalCoverImages() {
    var featureEnabled = false;
    var config = browzine.journalCoverImagesEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showJournalBrowZineWebLinkText() {
    var featureEnabled = false;
    var config = browzine.journalBrowZineWebLinkTextEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showArticleBrowZineWebLinkText() {
    var featureEnabled = false;
    var config = browzine.articleBrowZineWebLinkTextEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showDirectToPDFLink() {
    var featureEnabled = false;
    var config = browzine.articlePDFDownloadLinkEnabled;
    var prefixConfig = browzine.primoArticlePDFDownloadLinkEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    if (typeof prefixConfig !== "undefined" && prefixConfig !== null && prefixConfig === false) {
      featureEnabled = false;
    }

    return featureEnabled;
  };

  function showArticleLink() {
    var featureEnabled = false;
    var config = browzine.articleLinkEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showPrintRecords() {
    var featureEnabled = false;
    var config = browzine.printRecordsIntegrationEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showRetractionWatch() {
    var featureEnabled = false;
    var config = browzine.articleRetractionWatchEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showExpressionOfConcern() {
    var featureEnabled = false;
    var config = browzine.articleExpressionOfConcernEnabled;

    if(typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    };

    return featureEnabled;
  };

  function showFormatChoice() {
    var featureEnabled = false;
    var config = browzine.showFormatChoice;

    if (config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showLinkResolverLink() {
    var featureEnabled = false;
    var config = browzine.showLinkResolverLink;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function enableLinkOptimizer() {
    var featureEnabled = false;
    var config = browzine.enableLinkOptimizer;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function isFiltered(scope) {
    var validation = false;
    var result = getResult(scope);

    if (result && result.delivery) {
      if (result.delivery.deliveryCategory && result.delivery.deliveryCategory.length > 0) {
        var deliveryCategory = result.delivery.deliveryCategory[0].trim().toLowerCase();

        if (deliveryCategory === "alma-p" && !showPrintRecords()) {
          validation = true;
        }
      }
    }

    return validation;
  };

  function transition(event, anchor) {
    // We’ve seen some discovery services intercept basic a href links, and have
    // been encouraged to intercept clicks more closely. We should continue
    // intercepting clicks like this unless we hear feedback from discovery
    // service vendors that this is no longer desired or necessary.
    event.preventDefault();
    event.stopPropagation();

    window.open(anchor.href, anchor.target);

    return false;
  };

  function showRetractionWatchUI(articleRetractionUrl) {
    return articleRetractionUrl && showRetractionWatch();
  };

  function showEocNoticeUI(articleEocNoticeUrl) {
    return articleEocNoticeUrl && showExpressionOfConcern();
  }

  function showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl) {
    return !!problematicJournalArticleNoticeUrl;
  }

  function directToPDFTemplate(directToPDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl) {
    var pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-pdf-download-icon.svg";
    var pdfIconWidth = "12";
    var pdfIconMarginRight = "4.5px";
    var articlePDFDownloadLinkText = browzine.articlePDFDownloadLinkText || browzine.primoArticlePDFDownloadLinkText  || "Download PDF";

    if (showRetractionWatchUI(articleRetractionUrl)) {
      directToPDFUrl = articleRetractionUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleRetractionWatchText || "Retracted Article";
    } else if (showEocNoticeUI(articleEocNoticeUrl)) {
      directToPDFUrl = articleEocNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";
    } else if (showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl)) {
      directToPDFUrl = problematicJournalArticleNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.problematicJournalText || "Problematic Journal";
    }

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-direct-to-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> " +
                          "<span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{directToPDFUrl}/g, directToPDFUrl);
    template = template.replace(/{articlePDFDownloadLinkText}/g, articlePDFDownloadLinkText);
    template = template.replace(/{pdfIcon}/g, pdfIcon);
    template = template.replace(/{pdfIconWidth}/g, pdfIconWidth);
    template = template.replace(/{pdfIconMarginRight}/g, pdfIconMarginRight);

    return template;
  };

  function articleLinkTemplate(articleLinkUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl) {
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-article-link-icon.svg";
    var linkIconWidth = "12";
    var linkIconMarginRight = "4.5px";
    var articleLinkText = browzine.articleLinkText  || "Read Article";

    if (showRetractionWatchUI(articleRetractionUrl)) {
      articleLinkUrl = articleRetractionUrl;
      linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      linkIconWidth = "15";
      linkIconMarginRight = "1.5px";
      articleLinkText = browzine.articleRetractionWatchText || "Retracted Article";
    } else if (showEocNoticeUI(articleEocNoticeUrl)) {
      articleLinkUrl = articleEocNoticeUrl;
      linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      linkIconWidth = "15";
      linkIconMarginRight = "1.5px";
      articleLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";
    } else if (showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl)) {
      articleLinkUrl = problematicJournalArticleNoticeUrl;
      linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      linkIconWidth = "15";
      linkIconMarginRight = "1.5px";
      articleLinkText = browzine.problematicJournalText || "Problematic Journal";
    }

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);
    template = template.replace(/{linkIconWidth}/g, linkIconWidth);
    template = template.replace(/{linkIconMarginRight}/g, linkIconMarginRight);

    return template;
  };

  function retractionWatchLinkTemplate(articleRetractionUrl) {
    var articleLinkUrl = articleRetractionUrl;
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
    var linkIconWidth = "15";
    var linkIconMarginRight = "1.5px";
    var articleLinkText = browzine.articleRetractionWatchText || "Retracted Article";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);
    template = template.replace(/{linkIconWidth}/g, linkIconWidth);
    template = template.replace(/{linkIconMarginRight}/g, linkIconMarginRight);

    return template;
  };

  function eocLinkTemplate(articleEocNoticeUrl) {
    var articleLinkUrl = articleEocNoticeUrl;
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
    var linkIconWidth = "15";
    var linkIconMarginRight = "1.5px";
    var articleLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);
    template = template.replace(/{linkIconWidth}/g, linkIconWidth);
    template = template.replace(/{linkIconMarginRight}/g, linkIconMarginRight);

    return template;
  };

  function problematicJournalArticleNoticeLinkTemplate(problematicJournalArticleNoticeUrl) {
    var articleLinkUrl = problematicJournalArticleNoticeUrl;
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
    var linkIconWidth = "15";
    var linkIconMarginRight = "1.5px";
    var articleLinkText = browzine.problematicJournalText || "Problematic Journal";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);
    template = template.replace(/{linkIconWidth}/g, linkIconWidth);
    template = template.replace(/{linkIconMarginRight}/g, linkIconMarginRight);

    return template;
  };


  function browzineWebLinkTemplate(scope, browzineWebLink) {
    var browzineWebLinkText = "";
    var bookIcon = "https://assets.thirdiron.com/images/integrations/browzine-open-book-icon.svg";

    if (isJournal(scope)) {
      browzineWebLinkText = browzine.journalBrowZineWebLinkText || browzine.primoJournalBrowZineWebLinkText || "View Journal Contents";
    }

    if (isArticle(scope)) {
      browzineWebLinkText = browzine.articleBrowZineWebLinkText || browzine.primoArticleBrowZineWebLinkText || "View Issue Contents";
    }

    var template = "<div class='browzine' style='line-height: 1.4em;'>" +
                      "<a class='browzine-web-link' href='{browzineWebLink}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Book Icon' src='{bookIcon}' class='browzine-book-icon' style='margin-bottom: -2px; margin-right: 2.5px;' aria-hidden='true' width='15' height='15'/> " +
                          "<span class='browzine-web-link-text'>{browzineWebLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{browzineWebLink}/g, browzineWebLink);
    template = template.replace(/{browzineWebLinkText}/g, browzineWebLinkText);
    template = template.replace(/{bookIcon}/g, bookIcon);

    return template;
  };

  function unpaywallArticlePDFTemplate(directToPDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl) {
    var pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-pdf-download-icon.svg";
    var pdfIconWidth = "12";
    var pdfIconMarginRight = "4.5px";
    var articlePDFDownloadLinkText = browzine.articlePDFDownloadViaUnpaywallText  || "Download PDF (via Unpaywall)";

    if (showRetractionWatchUI(articleRetractionUrl)) {
      directToPDFUrl = articleRetractionUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleRetractionWatchText || "Retracted Article";
    } else if (showEocNoticeUI(articleEocNoticeUrl)) {
      directToPDFUrl = articleEocNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";
    } else if (showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl)) {
      directToPDFUrl = problematicJournalArticleNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.problematicJournalText || "Problematic Journal";
    }

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='unpaywall-article-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> " +
                          "<span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{directToPDFUrl}/g, directToPDFUrl);
    template = template.replace(/{articlePDFDownloadLinkText}/g, articlePDFDownloadLinkText);
    template = template.replace(/{pdfIcon}/g, pdfIcon);
    template = template.replace(/{pdfIconWidth}/g, pdfIconWidth);
    template = template.replace(/{pdfIconMarginRight}/g, pdfIconMarginRight);

    return template;
  };

  //TODO: BZ 8196 - Will address the need here for retraction/eoc handling as well as ironing out some logic.
  function unpaywallArticleLinkTemplate(articleLinkUrl) {
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-article-link-icon.svg";
    var articleLinkText = browzine.articleLinkViaUnpaywallText  || "Read Article (via Unpaywall)";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='unpaywall-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: 4.5px;' aria-hidden='true' width='12' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);

    return template;
  };

  function unpaywallManuscriptPDFTemplate(directToPDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl) {
    var pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-pdf-download-icon.svg";
    var pdfIconWidth = "12";
    var pdfIconMarginRight = "4.5px";
    var articlePDFDownloadLinkText = browzine.articleAcceptedManuscriptPDFViaUnpaywallText  || "Download PDF (Accepted Manuscript via Unpaywall)";

    if (showRetractionWatchUI(articleRetractionUrl)) {
      directToPDFUrl = articleRetractionUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleRetractionWatchText || "Retracted Article";
    } else if (showEocNoticeUI(articleEocNoticeUrl)) {
      directToPDFUrl = articleEocNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";
    } else if (showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl)) {
      articleLinkUrl = problematicJournalArticleNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.problematicJournalText || "Problematic Journal";
    }

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='unpaywall-manuscript-article-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> " +
                          "<span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{directToPDFUrl}/g, directToPDFUrl);
    template = template.replace(/{articlePDFDownloadLinkText}/g, articlePDFDownloadLinkText);
    template = template.replace(/{pdfIcon}/g, pdfIcon);
    template = template.replace(/{pdfIconWidth}/g, pdfIconWidth);
    template = template.replace(/{pdfIconMarginRight}/g, pdfIconMarginRight);

    return template;
  };

  function unpaywallManuscriptLinkTemplate(articleLinkUrl) {
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-article-link-icon.svg";
    var articleLinkText = browzine.articleAcceptedManuscriptArticleLinkViaUnpaywallText  || "Read Article (Accepted Manuscript via Unpaywall)";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='unpaywall-manuscript-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: 4.5px;' aria-hidden='true' width='12' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);

    return template;
  };

  function isUnpaywallEnabled() {
    return browzine.articlePDFDownloadViaUnpaywallEnabled || browzine.articleLinkViaUnpaywallEnabled || browzine.articleAcceptedManuscriptPDFViaUnpaywallEnabled || browzine.articleAcceptedManuscriptArticleLinkViaUnpaywallEnabled;
  };

  function getElement(scope) {
    return scope.$element;
  };

  function getElementParent(element) {
    return element[0].offsetParent || element[0];
  };

  function getScope($scope) {
    var scope;

    if ($scope && $scope.$ctrl && $scope.$ctrl.parentCtrl && $scope.$ctrl.parentCtrl.$element) {
      // Pre-Primo Angular 1.8.3
      // 3i Normal Integration: ✓
      // Primo Studio Integration: ✓

      // Post-Primo Angular 1.8.3
      // 3i Normal Integration: ✗
      // Primo Studio Integration: ✗
      scope = $scope.$ctrl.parentCtrl;
    } else if ($scope && $scope.$parent && $scope.$parent.$ctrl && $scope.$parent.$ctrl.$element) {
      // Pre-Primo Angular 1.8.3
      // 3i Normal Integration: ✓
      // Primo Studio Integration: ✗

      // Post-Primo Angular 1.8.3
      // 3i Normal Integration: ✓
      // Primo Studio Integration: ✗
      scope = $scope.$parent.$ctrl;
    } else if ($scope && $scope.$parent && $scope.$parent.$ctrl && $scope.$parent.$ctrl.parentCtrl && $scope.$parent.$ctrl.parentCtrl.$element) {
      // Pre-Primo Angular 1.8.3
      // 3i Normal Integration: ✗
      // Primo Studio Integration: ✗

      // Post-Primo Angular 1.8.3
      // 3i Normal Integration: ✗
      // Primo Studio Integration: ✓
      scope = $scope.$parent.$ctrl.parentCtrl;
    }

    return scope;
  };

  function shouldEnhance(scope) {
    var validation = false;

    if (!isFiltered(scope)) {
      if (isJournal(scope) && getIssn(scope)) {
        validation = true;
      }

      if (isArticle(scope) && getDoi(scope)) {
        validation = true;
      }

      if (isArticle(scope) && !getDoi(scope) && getIssn(scope)) {
        validation = true;
      }
    }

    return validation;
  };

  function shouldAvoidUnpaywall(response) {
    if (response.hasOwnProperty('meta') && response.meta.hasOwnProperty('avoidUnpaywall')) {
      return response.meta.avoidUnpaywall;
    } else {
      return false;
    };
  }

  function shouldIgnoreUnpaywallResponse(response, unpaywallResponse) {
    if (response.hasOwnProperty('data') && response.data.hasOwnProperty('avoidUnpaywallPublisherLinks')) {
      if (unpaywallResponse.best_oa_location && unpaywallResponse.best_oa_location.host_type === "publisher") {
        return true;
      }
    }
    return false;
  }

  function searchResult($scope) {
    var scope = getScope($scope);

    if (!shouldEnhance(scope)) {
      return;
    }

    var endpoint = getEndpoint(scope);

    var request = new XMLHttpRequest();
    request.open("GET", endpoint, true);
    request.setRequestHeader("Content-type", "application/json");

    request.onload = function() {
      if (request.readyState == XMLHttpRequest.DONE && request.status == 200) {
        var response = JSON.parse(request.response);

        var data = getData(response);
        var journal = getIncludedJournal(response);

        var browzineWebLink = getBrowZineWebLink(data);
        var coverImageUrl = getCoverImageUrl(scope, data, journal);
        var browzineEnabled = getBrowZineEnabled(scope, data, journal);
        var defaultCoverImage = isDefaultCoverImage(coverImageUrl);
        var directToPDFUrl = getDirectToPDFUrl(scope, data);
        var unpaywallUsable = getUnpaywallUsable(scope, data);
        var articleLinkUrl = getArticleLinkUrl(scope, data);
        var articleRetractionUrl = getArticleRetractionUrl(scope, data);
        var articleEocNoticeUrl = getArticleEOCNoticeUrl(scope, data);
        var problematicJournalArticleNoticeUrl = getProblematicJournalArticleNoticeUrl(scope, data);

        var element = getElement(scope);

        var libKeyLinkOptimizer = document.createElement("div");
        libKeyLinkOptimizer.className = "libkey-link-optimizer";
        libKeyLinkOptimizer.style = "display: flex; justify-content: flex-start;";

        if (directToPDFUrl && isArticle(scope) && showDirectToPDFLink()) {
          var template = directToPDFTemplate(directToPDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if ((!directToPDFUrl || (showFormatChoice() && !articleRetractionUrl && !articleEocNoticeUrl && !problematicJournalArticleNoticeUrl)) && articleLinkUrl && isArticle(scope) && showDirectToPDFLink() && showArticleLink()) {
          var template = articleLinkTemplate(articleLinkUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if (!directToPDFUrl && !articleLinkUrl && articleRetractionUrl && isArticle(scope) && showRetractionWatch()) {
          var template = retractionWatchLinkTemplate(articleRetractionUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if (!directToPDFUrl && !articleLinkUrl && !articleRetractionUrl && articleEocNoticeUrl && isArticle(scope) && showExpressionOfConcern()) {
          var template = eocLinkTemplate(articleEocNoticeUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if (!directToPDFUrl && !articleLinkUrl && !articleRetractionUrl && !articleEocNoticeUrl && problematicJournalArticleNoticeUrl && isArticle(scope)) {
          var template = problematicJournalArticleNoticeLinkTemplate(problematicJournalArticleNoticeUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if (libKeyLinkOptimizer.innerHTML) {
          (function poll() {
            var elementParent = getElementParent(element);
            var availabilityLine = elementParent.querySelector("prm-search-result-availability-line .layout-align-start-start");

            if (availabilityLine) {
              availabilityLine.insertAdjacentHTML('afterbegin', libKeyLinkOptimizer.outerHTML);
            } else {
              requestAnimationFrame(poll);
            }
          })();
        }

        if (browzineWebLink && browzineEnabled && isJournal(scope) && showJournalBrowZineWebLinkText()) {
          var template = browzineWebLinkTemplate(scope, browzineWebLink);
          element.append(template);
        }

        if (browzineWebLink && browzineEnabled && isArticle(scope) && (directToPDFUrl || articleLinkUrl) && showArticleBrowZineWebLinkText()) {
          var template = browzineWebLinkTemplate(scope, browzineWebLink);
          element.append(template);
        }

        if (coverImageUrl && !defaultCoverImage && showJournalCoverImages()) {
          (function poll() {
            var elementParent = getElementParent(element);
            var coverImages = elementParent.querySelectorAll("prm-search-result-thumbnail-container img");

            if (coverImages && coverImages[0] && coverImages[0].className.indexOf("fan-img") > -1) {
              Array.prototype.forEach.call(coverImages, function(coverImage) {
                coverImage.src = coverImageUrl;
              });
            } else {
              requestAnimationFrame(poll);
            }
          })();
        }

        if (!showLinkResolverLink() && (directToPDFUrl || articleLinkUrl)) {
          var elementParent = getElementParent(element);
          var contentLinkElement = elementParent.querySelector("prm-search-result-availability-line .layout-align-start-start .layout-row");

          if (contentLinkElement) {
            contentLinkElement.remove();
          }
        }

        if ((directToPDFUrl || articleLinkUrl) && enableLinkOptimizer()) {
          var elementParent = getElementParent(element);
          var quickLinkElement = elementParent.querySelector("prm-quick-link");

          if (quickLinkElement) {
            quickLinkElement.remove();
          }
        }
      }

      if ((request.readyState == XMLHttpRequest.DONE && request.status == 404) || (isArticle(scope) && (!directToPDFUrl && !articleLinkUrl && unpaywallUsable))) {

        var response = JSON.parse(request.response || '{}');
        var shouldAvoidUnpaywallLiveCall = shouldAvoidUnpaywall(response);
        if (shouldAvoidUnpaywallLiveCall) {
          return
        }

        var endpoint = getUnpaywallEndpoint(scope);
        if (endpoint && isUnpaywallEnabled()) {
          var requestUnpaywall = new XMLHttpRequest();
          requestUnpaywall.open("GET", endpoint, true);
          requestUnpaywall.setRequestHeader("Content-type", "application/json");

          requestUnpaywall.onload = function() {
            if (requestUnpaywall.readyState == XMLHttpRequest.DONE && requestUnpaywall.status == 200) {
              var responseUnpaywall = JSON.parse(requestUnpaywall.response);

              if (shouldIgnoreUnpaywallResponse(response, responseUnpaywall)) {
                return;
              }

              var unpaywallArticlePDFUrl = getUnpaywallArticlePDFUrl(responseUnpaywall);
              var unpaywallArticleLinkUrl = getUnpaywallArticleLinkUrl(responseUnpaywall);
              var unpaywallManuscriptArticlePDFUrl = getUnpaywallManuscriptArticlePDFUrl(responseUnpaywall);
              var unpaywallManuscriptArticleLinkUrl = getUnpaywallManuscriptArticleLinkUrl(responseUnpaywall);
              var articleRetractionUrl = getArticleRetractionUrl(scope, data);
              var articleEocNoticeUrl = getArticleEOCNoticeUrl(scope, data);
              var problematicJournalArticleNoticeUrl = getProblematicJournalArticleNoticeUrl(scope, data);

              var template;
              var pdfAvailable = false;

              if (unpaywallArticlePDFUrl && browzine.articlePDFDownloadViaUnpaywallEnabled) {
                template = unpaywallArticlePDFTemplate(unpaywallArticlePDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl);
                pdfAvailable = true;
              } else if (unpaywallArticleLinkUrl && browzine.articleLinkViaUnpaywallEnabled ) {
                template = unpaywallArticleLinkTemplate(unpaywallArticleLinkUrl);
              } else if (unpaywallManuscriptArticlePDFUrl && browzine.articleAcceptedManuscriptPDFViaUnpaywallEnabled) {
                template = unpaywallManuscriptPDFTemplate(unpaywallManuscriptArticlePDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl);
                pdfAvailable = true;
              } else if (unpaywallManuscriptArticleLinkUrl && browzine.articleAcceptedManuscriptArticleLinkViaUnpaywallEnabled) {
                template = unpaywallManuscriptLinkTemplate(unpaywallManuscriptArticleLinkUrl);
              }

              if (template) {
                var element = getElement(scope);

                (function poll() {
                  var elementParent = getElementParent(element);
                  var availabilityLine = elementParent.querySelector("prm-search-result-availability-line .layout-align-start-start");

                  if (availabilityLine) {
                    availabilityLine.insertAdjacentHTML('afterbegin', template);
                  } else {
                    requestAnimationFrame(poll);
                  }
                })();
              }

              if (!showLinkResolverLink() && template) {
                var element = getElement(scope);

                (function poll() {
                  var elementParent = getElementParent(element);
                  var contentLinkElement = elementParent.querySelector("prm-search-result-availability-line .layout-align-start-start .layout-row");

                  if (contentLinkElement) {
                    contentLinkElement.remove();
                  } else {
                    requestAnimationFrame(poll);
                  }
                })();
              }

              if (template) {
                var element = getElement(scope);

                (function poll() {
                  var elementParent = getElementParent(element);
                  var quickLinkElement = elementParent.querySelector("prm-quick-link");

                  if (quickLinkElement) {
                    quickLinkElement.remove();
                  } else {
                    requestAnimationFrame(poll);
                  }
                })();
              }
            }
          };

          requestUnpaywall.send();
        }
      }
    };

    request.send();
  };

  return {
    searchResult: searchResult,
    urlRewrite: urlRewrite,
    libraryIdOverride: libraryIdOverride,
    getResult: getResult,
    isArticle: isArticle,
    isJournal: isJournal,
    getIssn: getIssn,
    getDoi: getDoi,
    isFiltered: isFiltered,
    getEndpoint: getEndpoint,
    getUnpaywallEndpoint: getUnpaywallEndpoint,
    shouldEnhance: shouldEnhance,
    getData: getData,
    getIncludedJournal: getIncludedJournal,
    getBrowZineWebLink: getBrowZineWebLink,
    getCoverImageUrl: getCoverImageUrl,
    getBrowZineEnabled: getBrowZineEnabled,
    isDefaultCoverImage: isDefaultCoverImage,
    getDirectToPDFUrl: getDirectToPDFUrl,
    getUnpaywallUsable: getUnpaywallUsable,
    getArticleLinkUrl: getArticleLinkUrl,
    getArticleRetractionUrl: getArticleRetractionUrl,
    getArticleEOCNoticeUrl: getArticleEOCNoticeUrl,
    isUnknownVersion: isUnknownVersion,
    isTrustedRepository: isTrustedRepository,
    getUnpaywallArticlePDFUrl: getUnpaywallArticlePDFUrl,
    getUnpaywallArticleLinkUrl: getUnpaywallArticleLinkUrl,
    getUnpaywallManuscriptArticlePDFUrl: getUnpaywallManuscriptArticlePDFUrl,
    getUnpaywallManuscriptArticleLinkUrl: getUnpaywallManuscriptArticleLinkUrl,
    showJournalCoverImages: showJournalCoverImages,
    showJournalBrowZineWebLinkText: showJournalBrowZineWebLinkText,
    showArticleBrowZineWebLinkText: showArticleBrowZineWebLinkText,
    showDirectToPDFLink: showDirectToPDFLink,
    showArticleLink: showArticleLink,
    showPrintRecords: showPrintRecords,
    showRetractionWatch: showRetractionWatch,
    showExpressionOfConcern: showExpressionOfConcern,
    showFormatChoice: showFormatChoice,
    showLinkResolverLink: showLinkResolverLink,
    enableLinkOptimizer: enableLinkOptimizer,
    transition: transition,
    directToPDFTemplate: directToPDFTemplate,
    articleLinkTemplate: articleLinkTemplate,
    retractionWatchLinkTemplate: retractionWatchLinkTemplate,
    eocLinkTemplate: eocLinkTemplate,
    browzineWebLinkTemplate: browzineWebLinkTemplate,
    unpaywallArticlePDFTemplate: unpaywallArticlePDFTemplate,
    unpaywallArticleLinkTemplate: unpaywallArticleLinkTemplate,
    unpaywallManuscriptPDFTemplate: unpaywallManuscriptPDFTemplate,
    unpaywallManuscriptLinkTemplate: unpaywallManuscriptLinkTemplate,
    isUnpaywallEnabled: isUnpaywallEnabled,
    getElement: getElement,
    getElementParent: getElementParent,
    getScope: getScope,
  };
}());
        ؘ x      20241209150345-8l 	J   https://s3.amazonaws.com/browzine-adapters/primo/browzine-primo-adapter.js      I  browzine.primo = (function() {
  var libraryId = browzine.libraryId;
  var api = libraryIdOverride(urlRewrite(browzine.api));
  var apiKey = browzine.apiKey;

  function urlRewrite(url) {
    if (!url) {
      return;
    } else if (url.indexOf("staging-api.thirdiron.com") > -1) {
      return url;
    }

    return url.indexOf("public-api.thirdiron.com") > -1 ? url : url.replace("api.thirdiron.com", "public-api.thirdiron.com");
  };

  function libraryIdOverride(url) {
    var override = url;
    var libraryId = browzine.libraryId;

    if (libraryId) {
      var baseUrl = "https://public-api.thirdiron.com/public/v1/libraries/{libraryId}";
      override = baseUrl.replace(/{libraryId}/g, libraryId);
    }

    return override;
  };

  function getResult(scope) {
    return scope.result || scope.item;
  };

  function isArticle(scope) {
    var validation = false;
    var result = getResult(scope);

    if (result && result.pnx) {
      if (result.pnx.display && result.pnx.display.type) {
        var contentType = result.pnx.display.type[0].trim().toLowerCase();

        if (contentType.indexOf("article") > -1) {
          validation = true;
        }
      }
    }

    return validation;
  };

  function isJournal(scope) {
    var validation = false;
    var result = getResult(scope);

    if (result && result.pnx) {
      if (result.pnx.display && result.pnx.display.type) {
        var contentType = result.pnx.display.type[0].trim().toLowerCase();

        if (contentType.indexOf("journal") > -1) {
          validation = true;
        }
      }
    }

    return validation;
  };

  function getIssn(scope) {
    var issn = "";
    var result = getResult(scope);

    if (result && result.pnx && result.pnx.addata) {
      if (result.pnx.addata.issn) {
        if (result.pnx.addata.issn.length > 1) {
          issn = result.pnx.addata.issn.filter(function(issn) {
            return (issn.length < 10) && (/[\S]{4}\-[\S]{4}/.test(issn));
          }).join(",").trim().replace(/-/g, "");
        } else {
          if (result.pnx.addata.issn[0]) {
            issn = result.pnx.addata.issn[0].trim().replace("-", "");
          }
        }
      }

      if (result.pnx.addata.eissn && !issn) {
        if (result.pnx.addata.eissn.length > 1) {
          issn = result.pnx.addata.eissn.filter(function(issn) {
            return (issn.length < 10) && (/[\S]{4}\-[\S]{4}/.test(issn));
          }).join(",").trim().replace(/-/g, "");
        } else {
          if (result.pnx.addata.eissn[0]) {
            issn = result.pnx.addata.eissn[0].trim().replace("-", "");
          }
        }
      }
    }

    return encodeURIComponent(issn);
  };

  function getDoi(scope) {
    var doi = "";
    var result = getResult(scope);

    if (result && result.pnx) {
      if (result.pnx.addata && result.pnx.addata.doi) {
        if (result.pnx.addata.doi[0]) {
          doi = result.pnx.addata.doi[0].trim();
        }
      }
    }

    return encodeURIComponent(doi);
  };

  function getEndpoint(scope) {
    var endpoint = "";

    if (isJournal(scope) && getIssn(scope)) {
      var issn = getIssn(scope);
      endpoint = api + "/search?issns=" + issn;
    }

    if (isArticle(scope) && getDoi(scope)) {
      var doi = getDoi(scope);
      endpoint = api + "/articles/doi/" + doi + "?include=journal,library";
    }

    if (isArticle(scope) && !getDoi(scope) && getIssn(scope)) {
      var issn = getIssn(scope);
      endpoint = api + "/search?issns=" + issn;
    }

    endpoint += "&access_token=" + apiKey;

    return endpoint;
  };

  function getUnpaywallEndpoint(scope) {
    var endpoint;
    var email = browzine.unpaywallEmailAddressKey;

    if (isArticle(scope) && getDoi(scope) && email) {
      var doi = getDoi(scope);
      endpoint = "https://api.unpaywall.org/v2/" + doi + "?email=" + email;
    }

    return endpoint;
  };

  function getData(response) {
    var data = {};

    if (Array.isArray(response.data)) {
      data = response.data.filter(function(journal) {
        return journal.browzineEnabled === true;
      }).pop();
    } else {
      data = response.data;
    }

    return data;
  };

  function getIncludedJournal(response) {
    var journal = null;

    if (response.included) {
      journal = Array.isArray(response.included) ? response.included[0] : response.included;
    }

    return journal;
  };

  function getBrowZineWebLink(data) {
    var browzineWebLink = null;

    if (data && data.browzineWebLink) {
      browzineWebLink = data.browzineWebLink;
    }

    return browzineWebLink;
  };

  function getCoverImageUrl(scope, data, journal) {
    var coverImageUrl = null;

    if (isJournal(scope) && getIssn(scope)) {
      if (data && data.coverImageUrl) {
        coverImageUrl = data.coverImageUrl;
      }
    }

    if (isArticle(scope) && getDoi(scope)) {
      if (journal && journal.coverImageUrl) {
        coverImageUrl = journal.coverImageUrl;
      }
    }

    if (isArticle(scope) && !getDoi(scope) && getIssn(scope)) {
      if (data && data.coverImageUrl) {
        coverImageUrl = data.coverImageUrl;
      }
    }

    return coverImageUrl;
  };

  function getBrowZineEnabled(scope, data, journal) {
    var browzineEnabled = false;

    if (isJournal(scope)) {
      if (data && data.browzineEnabled) {
        browzineEnabled = data.browzineEnabled;
      }
    }

    if (isArticle(scope)) {
      if (journal && journal.browzineEnabled) {
        browzineEnabled = journal.browzineEnabled;
      }
    }

    return browzineEnabled;
  };

  function isDefaultCoverImage(coverImageUrl) {
    var defaultCoverImage = false;

    if (coverImageUrl && coverImageUrl.toLowerCase().indexOf("default") > -1) {
      defaultCoverImage = true;
    }

    return defaultCoverImage;
  };

  function getDirectToPDFUrl(scope, data) {
    var directToPDFUrl = null;

    if (isArticle(scope)) {
      if (data && data.fullTextFile) {
        directToPDFUrl = data.fullTextFile;
      }
    }

    return directToPDFUrl;
  };

  function getUnpaywallUsable(scope, data) {
    if (!isArticle(scope)) {
      return false;
    }
    if (!data || !data.hasOwnProperty("unpaywallUsable")) {
      return true;
    }
    return !!data.unpaywallUsable;
  };

  function getArticleLinkUrl(scope, data) {
    var articleLinkUrl = null;

    if (isArticle(scope)) {
      if (data && data.contentLocation) {
        articleLinkUrl = data.contentLocation;
      }
    }

    return articleLinkUrl;
  };

  function getArticleRetractionUrl(scope, data) {
    var articleRetractionUrl = null;

    if (isArticle(scope)) {
      if (data && data.retractionNoticeUrl) {
        articleRetractionUrl = data.retractionNoticeUrl;
      }
    }

    return articleRetractionUrl;
  };

  function getArticleEOCNoticeUrl(scope, data) {
    var articleEocNoticeUrl = null;

    if (isArticle(scope)) {
      if (data && data.expressionOfConcernNoticeUrl) {
        articleEocNoticeUrl = data.expressionOfConcernNoticeUrl;
      }
    }
    return articleEocNoticeUrl;
  }

  function getProblematicJournalArticleNoticeUrl(scope, data) {
    var problematicJournalArticleNoticeUrl = null;

    if (isArticle(scope)) {
      if (data && data.problematicJournalArticleNoticeUrl) {
        problematicJournalArticleNoticeUrl = data.problematicJournalArticleNoticeUrl;
      }
    }
    return problematicJournalArticleNoticeUrl;
  }

  function isTrustedRepository(response) {
    var validation = false;

    if (response.best_oa_location && response.best_oa_location.url_for_pdf) {
      if (response.best_oa_location.url_for_pdf.indexOf('nih.gov') > -1 || response.best_oa_location.url_for_pdf.indexOf('europepmc.org') > -1) {
        validation = true;
      }
    }

    return validation;
  };

  function isUnknownVersion(response) {
    var validation = false;

    if (response.best_oa_location) {
      if (!response.best_oa_location.version || response.best_oa_location.version === '') {
        validation = true;
      }
    }

    return validation;
  };

  function getUnpaywallArticlePDFUrl(response) {
    var url;

    if (response.best_oa_location) {
      if (response.best_oa_location.host_type === "publisher" || response.best_oa_location.host_type === "repository") {
        if (response.best_oa_location.version === "publishedVersion" || (isUnknownVersion(response) && isTrustedRepository(response))) {
          if (response.best_oa_location.url_for_pdf) {
            url = response.best_oa_location.url_for_pdf;
          }
        }
      }
    }

    return url;
  };

  function getUnpaywallArticleLinkUrl(response) {
    var url;

    if (response.best_oa_location) {
      if (response.best_oa_location.host_type === "publisher" || response.best_oa_location.host_type === "repository") {
        if (response.best_oa_location.version === "publishedVersion") {
          if (!response.best_oa_location.url_for_pdf) {
            url = response.best_oa_location.url_for_landing_page;
          }
        }
      }
    }

    return url;
  };

  function getUnpaywallManuscriptArticlePDFUrl(response) {
    var url;

    if (response.best_oa_location) {
      if (response.best_oa_location.host_type === "repository") {
        if (response.best_oa_location.version === "acceptedVersion" || (isUnknownVersion(response) && !isTrustedRepository(response))) {
          if (response.best_oa_location.url_for_pdf) {
            url = response.best_oa_location.url_for_pdf;
          }
        }
      }
    }

    return url;
  };

  function getUnpaywallManuscriptArticleLinkUrl(response) {
    var url;

    if (response.best_oa_location) {
      if (response.best_oa_location.host_type === "repository") {
        if (response.best_oa_location.version === "acceptedVersion") {
          if (!response.best_oa_location.url_for_pdf) {
            url = response.best_oa_location.url_for_landing_page;
          }
        }
      }
    }

    return url;
  };

  function showJournalCoverImages() {
    var featureEnabled = false;
    var config = browzine.journalCoverImagesEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showJournalBrowZineWebLinkText() {
    var featureEnabled = false;
    var config = browzine.journalBrowZineWebLinkTextEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showArticleBrowZineWebLinkText() {
    var featureEnabled = false;
    var config = browzine.articleBrowZineWebLinkTextEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showDirectToPDFLink() {
    var featureEnabled = false;
    var config = browzine.articlePDFDownloadLinkEnabled;
    var prefixConfig = browzine.primoArticlePDFDownloadLinkEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    if (typeof prefixConfig !== "undefined" && prefixConfig !== null && prefixConfig === false) {
      featureEnabled = false;
    }

    return featureEnabled;
  };

  function showArticleLink() {
    var featureEnabled = false;
    var config = browzine.articleLinkEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showPrintRecords() {
    var featureEnabled = false;
    var config = browzine.printRecordsIntegrationEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showRetractionWatch() {
    var featureEnabled = false;
    var config = browzine.articleRetractionWatchEnabled;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showExpressionOfConcern() {
    var featureEnabled = false;
    var config = browzine.articleExpressionOfConcernEnabled;

    if(typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    };

    return featureEnabled;
  };

  function showFormatChoice() {
    var featureEnabled = false;
    var config = browzine.showFormatChoice;

    if (config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function showLinkResolverLink() {
    var featureEnabled = false;
    var config = browzine.showLinkResolverLink;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function enableLinkOptimizer() {
    var featureEnabled = false;
    var config = browzine.enableLinkOptimizer;

    if (typeof config === "undefined" || config === null || config === true) {
      featureEnabled = true;
    }

    return featureEnabled;
  };

  function isFiltered(scope) {
    var validation = false;
    var result = getResult(scope);

    if (result && result.delivery) {
      if (result.delivery.deliveryCategory && result.delivery.deliveryCategory.length > 0) {
        var deliveryCategory = result.delivery.deliveryCategory[0].trim().toLowerCase();

        if (deliveryCategory === "alma-p" && !showPrintRecords()) {
          validation = true;
        }
      }
    }

    return validation;
  };

  function transition(event, anchor) {
    // We’ve seen some discovery services intercept basic a href links, and have
    // been encouraged to intercept clicks more closely. We should continue
    // intercepting clicks like this unless we hear feedback from discovery
    // service vendors that this is no longer desired or necessary.
    event.preventDefault();
    event.stopPropagation();

    window.open(anchor.href, anchor.target);

    return false;
  };

  function showRetractionWatchUI(articleRetractionUrl) {
    return articleRetractionUrl && showRetractionWatch();
  };

  function showEocNoticeUI(articleEocNoticeUrl) {
    return articleEocNoticeUrl && showExpressionOfConcern();
  }

  function showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl) {
    return !!problematicJournalArticleNoticeUrl;
  }

  function directToPDFTemplate(directToPDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl) {
    var pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-pdf-download-icon.svg";
    var pdfIconWidth = "12";
    var pdfIconMarginRight = "4.5px";
    var articlePDFDownloadLinkText = browzine.articlePDFDownloadLinkText || browzine.primoArticlePDFDownloadLinkText  || "Download PDF";

    if (showRetractionWatchUI(articleRetractionUrl)) {
      directToPDFUrl = articleRetractionUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleRetractionWatchText || "Retracted Article";
    } else if (showEocNoticeUI(articleEocNoticeUrl)) {
      directToPDFUrl = articleEocNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";
    } else if (showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl)) {
      directToPDFUrl = problematicJournalArticleNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.problematicJournalText || "Problematic Journal";
    }

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-direct-to-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> " +
                          "<span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{directToPDFUrl}/g, directToPDFUrl);
    template = template.replace(/{articlePDFDownloadLinkText}/g, articlePDFDownloadLinkText);
    template = template.replace(/{pdfIcon}/g, pdfIcon);
    template = template.replace(/{pdfIconWidth}/g, pdfIconWidth);
    template = template.replace(/{pdfIconMarginRight}/g, pdfIconMarginRight);

    return template;
  };

  function articleLinkTemplate(articleLinkUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl) {
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-article-link-icon.svg";
    var linkIconWidth = "12";
    var linkIconMarginRight = "4.5px";
    var articleLinkText = browzine.articleLinkText  || "Read Article";

    if (showRetractionWatchUI(articleRetractionUrl)) {
      articleLinkUrl = articleRetractionUrl;
      linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      linkIconWidth = "15";
      linkIconMarginRight = "1.5px";
      articleLinkText = browzine.articleRetractionWatchText || "Retracted Article";
    } else if (showEocNoticeUI(articleEocNoticeUrl)) {
      articleLinkUrl = articleEocNoticeUrl;
      linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      linkIconWidth = "15";
      linkIconMarginRight = "1.5px";
      articleLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";
    } else if (showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl)) {
      articleLinkUrl = problematicJournalArticleNoticeUrl;
      linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      linkIconWidth = "15";
      linkIconMarginRight = "1.5px";
      articleLinkText = browzine.problematicJournalText || "Problematic Journal";
    }

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);
    template = template.replace(/{linkIconWidth}/g, linkIconWidth);
    template = template.replace(/{linkIconMarginRight}/g, linkIconMarginRight);

    return template;
  };

  function retractionWatchLinkTemplate(articleRetractionUrl) {
    var articleLinkUrl = articleRetractionUrl;
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
    var linkIconWidth = "15";
    var linkIconMarginRight = "1.5px";
    var articleLinkText = browzine.articleRetractionWatchText || "Retracted Article";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);
    template = template.replace(/{linkIconWidth}/g, linkIconWidth);
    template = template.replace(/{linkIconMarginRight}/g, linkIconMarginRight);

    return template;
  };

  function eocLinkTemplate(articleEocNoticeUrl) {
    var articleLinkUrl = articleEocNoticeUrl;
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
    var linkIconWidth = "15";
    var linkIconMarginRight = "1.5px";
    var articleLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);
    template = template.replace(/{linkIconWidth}/g, linkIconWidth);
    template = template.replace(/{linkIconMarginRight}/g, linkIconMarginRight);

    return template;
  };

  function problematicJournalArticleNoticeLinkTemplate(problematicJournalArticleNoticeUrl) {
    var articleLinkUrl = problematicJournalArticleNoticeUrl;
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
    var linkIconWidth = "15";
    var linkIconMarginRight = "1.5px";
    var articleLinkText = browzine.problematicJournalText || "Problematic Journal";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);
    template = template.replace(/{linkIconWidth}/g, linkIconWidth);
    template = template.replace(/{linkIconMarginRight}/g, linkIconMarginRight);

    return template;
  };


  function browzineWebLinkTemplate(scope, browzineWebLink) {
    var browzineWebLinkText = "";
    var bookIcon = "https://assets.thirdiron.com/images/integrations/browzine-open-book-icon.svg";

    if (isJournal(scope)) {
      browzineWebLinkText = browzine.journalBrowZineWebLinkText || browzine.primoJournalBrowZineWebLinkText || "View Journal Contents";
    }

    if (isArticle(scope)) {
      browzineWebLinkText = browzine.articleBrowZineWebLinkText || browzine.primoArticleBrowZineWebLinkText || "View Issue Contents";
    }

    var template = "<div class='browzine' style='line-height: 1.4em;'>" +
                      "<a class='browzine-web-link' href='{browzineWebLink}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Book Icon' src='{bookIcon}' class='browzine-book-icon' style='margin-bottom: -2px; margin-right: 2.5px;' aria-hidden='true' width='15' height='15'/> " +
                          "<span class='browzine-web-link-text'>{browzineWebLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{browzineWebLink}/g, browzineWebLink);
    template = template.replace(/{browzineWebLinkText}/g, browzineWebLinkText);
    template = template.replace(/{bookIcon}/g, bookIcon);

    return template;
  };

  function unpaywallArticlePDFTemplate(directToPDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl) {
    var pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-pdf-download-icon.svg";
    var pdfIconWidth = "12";
    var pdfIconMarginRight = "4.5px";
    var articlePDFDownloadLinkText = browzine.articlePDFDownloadViaUnpaywallText  || "Download PDF (via Unpaywall)";

    if (showRetractionWatchUI(articleRetractionUrl)) {
      directToPDFUrl = articleRetractionUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleRetractionWatchText || "Retracted Article";
    } else if (showEocNoticeUI(articleEocNoticeUrl)) {
      directToPDFUrl = articleEocNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";
    } else if (showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl)) {
      directToPDFUrl = problematicJournalArticleNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.problematicJournalText || "Problematic Journal";
    }

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='unpaywall-article-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> " +
                          "<span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{directToPDFUrl}/g, directToPDFUrl);
    template = template.replace(/{articlePDFDownloadLinkText}/g, articlePDFDownloadLinkText);
    template = template.replace(/{pdfIcon}/g, pdfIcon);
    template = template.replace(/{pdfIconWidth}/g, pdfIconWidth);
    template = template.replace(/{pdfIconMarginRight}/g, pdfIconMarginRight);

    return template;
  };

  //TODO: BZ 8196 - Will address the need here for retraction/eoc handling as well as ironing out some logic.
  function unpaywallArticleLinkTemplate(articleLinkUrl) {
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-article-link-icon.svg";
    var articleLinkText = browzine.articleLinkViaUnpaywallText  || "Read Article (via Unpaywall)";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='unpaywall-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: 4.5px;' aria-hidden='true' width='12' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);

    return template;
  };

  function unpaywallManuscriptPDFTemplate(directToPDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl) {
    var pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-pdf-download-icon.svg";
    var pdfIconWidth = "12";
    var pdfIconMarginRight = "4.5px";
    var articlePDFDownloadLinkText = browzine.articleAcceptedManuscriptPDFViaUnpaywallText  || "Download PDF (Accepted Manuscript via Unpaywall)";

    if (showRetractionWatchUI(articleRetractionUrl)) {
      directToPDFUrl = articleRetractionUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleRetractionWatchText || "Retracted Article";
    } else if (showEocNoticeUI(articleEocNoticeUrl)) {
      directToPDFUrl = articleEocNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.articleExpressionOfConcernText || "Expression of Concern";
    } else if (showProblematicJournalArticleNoticeUI(problematicJournalArticleNoticeUrl)) {
      articleLinkUrl = problematicJournalArticleNoticeUrl;
      pdfIcon = "https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg";
      pdfIconWidth = "15";
      pdfIconMarginRight = "1.5px";
      articlePDFDownloadLinkText = browzine.problematicJournalText || "Problematic Journal";
    }

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='unpaywall-manuscript-article-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> " +
                          "<span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{directToPDFUrl}/g, directToPDFUrl);
    template = template.replace(/{articlePDFDownloadLinkText}/g, articlePDFDownloadLinkText);
    template = template.replace(/{pdfIcon}/g, pdfIcon);
    template = template.replace(/{pdfIconWidth}/g, pdfIconWidth);
    template = template.replace(/{pdfIconMarginRight}/g, pdfIconMarginRight);

    return template;
  };

  function unpaywallManuscriptLinkTemplate(articleLinkUrl) {
    var linkIcon = "https://assets.thirdiron.com/images/integrations/browzine-article-link-icon.svg";
    var articleLinkText = browzine.articleAcceptedManuscriptArticleLinkViaUnpaywallText  || "Read Article (Accepted Manuscript via Unpaywall)";

    var template = "<div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'>" +
                      "<a class='unpaywall-manuscript-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'>" +
                          "<img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: 4.5px;' aria-hidden='true' width='12' height='16'/> " +
                          "<span class='browzine-article-link-text'>{articleLinkText}</span> " +
                          "<md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon>" +
                      "</a>" +
                   "</div>";

    template = template.replace(/{articleLinkUrl}/g, articleLinkUrl);
    template = template.replace(/{articleLinkText}/g, articleLinkText);
    template = template.replace(/{linkIcon}/g, linkIcon);

    return template;
  };

  function isUnpaywallEnabled() {
    return browzine.articlePDFDownloadViaUnpaywallEnabled || browzine.articleLinkViaUnpaywallEnabled || browzine.articleAcceptedManuscriptPDFViaUnpaywallEnabled || browzine.articleAcceptedManuscriptArticleLinkViaUnpaywallEnabled;
  };

  function getElement(scope) {
    return scope.$element;
  };

  function getElementParent(element) {
    return element[0].offsetParent || element[0];
  };

  function getScope($scope) {
    var scope;

    if ($scope && $scope.$ctrl && $scope.$ctrl.parentCtrl && $scope.$ctrl.parentCtrl.$element) {
      // Pre-Primo Angular 1.8.3
      // 3i Normal Integration: ✓
      // Primo Studio Integration: ✓

      // Post-Primo Angular 1.8.3
      // 3i Normal Integration: ✗
      // Primo Studio Integration: ✗
      scope = $scope.$ctrl.parentCtrl;
    } else if ($scope && $scope.$parent && $scope.$parent.$ctrl && $scope.$parent.$ctrl.$element) {
      // Pre-Primo Angular 1.8.3
      // 3i Normal Integration: ✓
      // Primo Studio Integration: ✗

      // Post-Primo Angular 1.8.3
      // 3i Normal Integration: ✓
      // Primo Studio Integration: ✗
      scope = $scope.$parent.$ctrl;
    } else if ($scope && $scope.$parent && $scope.$parent.$ctrl && $scope.$parent.$ctrl.parentCtrl && $scope.$parent.$ctrl.parentCtrl.$element) {
      // Pre-Primo Angular 1.8.3
      // 3i Normal Integration: ✗
      // Primo Studio Integration: ✗

      // Post-Primo Angular 1.8.3
      // 3i Normal Integration: ✗
      // Primo Studio Integration: ✓
      scope = $scope.$parent.$ctrl.parentCtrl;
    }

    return scope;
  };

  function shouldEnhance(scope) {
    var validation = false;

    if (!isFiltered(scope)) {
      if (isJournal(scope) && getIssn(scope)) {
        validation = true;
      }

      if (isArticle(scope) && getDoi(scope)) {
        validation = true;
      }

      if (isArticle(scope) && !getDoi(scope) && getIssn(scope)) {
        validation = true;
      }
    }

    return validation;
  };

  function shouldAvoidUnpaywall(response) {
    if (response.hasOwnProperty('meta') && response.meta.hasOwnProperty('avoidUnpaywall')) {
      return response.meta.avoidUnpaywall;
    } else {
      return false;
    };
  }

  function shouldIgnoreUnpaywallResponse(response, unpaywallResponse) {
    if (response.hasOwnProperty('data') && response.data.hasOwnProperty('avoidUnpaywallPublisherLinks')) {
      if (unpaywallResponse.best_oa_location && unpaywallResponse.best_oa_location.host_type === "publisher") {
        return true;
      }
    }
    return false;
  }

  function searchResult($scope) {
    var scope = getScope($scope);

    if (!shouldEnhance(scope)) {
      return;
    }

    var endpoint = getEndpoint(scope);

    var request = new XMLHttpRequest();
    request.open("GET", endpoint, true);
    request.setRequestHeader("Content-type", "application/json");

    request.onload = function() {
      if (request.readyState == XMLHttpRequest.DONE && request.status == 200) {
        var response = JSON.parse(request.response);

        var data = getData(response);
        var journal = getIncludedJournal(response);

        var browzineWebLink = getBrowZineWebLink(data);
        var coverImageUrl = getCoverImageUrl(scope, data, journal);
        var browzineEnabled = getBrowZineEnabled(scope, data, journal);
        var defaultCoverImage = isDefaultCoverImage(coverImageUrl);
        var directToPDFUrl = getDirectToPDFUrl(scope, data);
        var unpaywallUsable = getUnpaywallUsable(scope, data);
        var articleLinkUrl = getArticleLinkUrl(scope, data);
        var articleRetractionUrl = getArticleRetractionUrl(scope, data);
        var articleEocNoticeUrl = getArticleEOCNoticeUrl(scope, data);
        var problematicJournalArticleNoticeUrl = getProblematicJournalArticleNoticeUrl(scope, data);

        var element = getElement(scope);

        var libKeyLinkOptimizer = document.createElement("div");
        libKeyLinkOptimizer.className = "libkey-link-optimizer";
        libKeyLinkOptimizer.style = "display: flex; justify-content: flex-start;";

        if (directToPDFUrl && isArticle(scope) && showDirectToPDFLink()) {
          var template = directToPDFTemplate(directToPDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if ((!directToPDFUrl || (showFormatChoice() && !articleRetractionUrl && !articleEocNoticeUrl && !problematicJournalArticleNoticeUrl)) && articleLinkUrl && isArticle(scope) && showDirectToPDFLink() && showArticleLink()) {
          var template = articleLinkTemplate(articleLinkUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if (!directToPDFUrl && !articleLinkUrl && articleRetractionUrl && isArticle(scope) && showRetractionWatch()) {
          var template = retractionWatchLinkTemplate(articleRetractionUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if (!directToPDFUrl && !articleLinkUrl && !articleRetractionUrl && articleEocNoticeUrl && isArticle(scope) && showExpressionOfConcern()) {
          var template = eocLinkTemplate(articleEocNoticeUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if (!directToPDFUrl && !articleLinkUrl && !articleRetractionUrl && !articleEocNoticeUrl && problematicJournalArticleNoticeUrl && isArticle(scope)) {
          var template = problematicJournalArticleNoticeLinkTemplate(problematicJournalArticleNoticeUrl);
          libKeyLinkOptimizer.innerHTML += template;
        }

        if (libKeyLinkOptimizer.innerHTML) {
          (function poll() {
            var elementParent = getElementParent(element);
            var availabilityLine = elementParent.querySelector("prm-search-result-availability-line .layout-align-start-start");

            if (availabilityLine) {
              availabilityLine.insertAdjacentHTML('afterbegin', libKeyLinkOptimizer.outerHTML);
            } else {
              requestAnimationFrame(poll);
            }
          })();
        }

        if (browzineWebLink && browzineEnabled && isJournal(scope) && showJournalBrowZineWebLinkText()) {
          var template = browzineWebLinkTemplate(scope, browzineWebLink);
          element.append(template);
        }

        if (browzineWebLink && browzineEnabled && isArticle(scope) && (directToPDFUrl || articleLinkUrl) && showArticleBrowZineWebLinkText()) {
          var template = browzineWebLinkTemplate(scope, browzineWebLink);
          element.append(template);
        }

        if (coverImageUrl && !defaultCoverImage && showJournalCoverImages()) {
          (function poll() {
            var elementParent = getElementParent(element);
            var coverImages = elementParent.querySelectorAll("prm-search-result-thumbnail-container img");

            if (coverImages && coverImages[0] && coverImages[0].className.indexOf("fan-img") > -1) {
              Array.prototype.forEach.call(coverImages, function(coverImage) {
                coverImage.src = coverImageUrl;
              });
            } else {
              requestAnimationFrame(poll);
            }
          })();
        }

        if (!showLinkResolverLink() && (directToPDFUrl || articleLinkUrl)) {
          var elementParent = getElementParent(element);
          var contentLinkElement = elementParent.querySelector("prm-search-result-availability-line .layout-align-start-start .layout-row");

          if (contentLinkElement) {
            contentLinkElement.remove();
          }
        }

        if ((directToPDFUrl || articleLinkUrl) && enableLinkOptimizer()) {
          var elementParent = getElementParent(element);
          var quickLinkElement = elementParent.querySelector("prm-quick-link");

          if (quickLinkElement) {
            quickLinkElement.remove();
          }
        }
      }

      if ((request.readyState == XMLHttpRequest.DONE && request.status == 404) || (isArticle(scope) && (!directToPDFUrl && !articleLinkUrl && unpaywallUsable))) {

        var response = JSON.parse(request.response || '{}');
        var shouldAvoidUnpaywallLiveCall = shouldAvoidUnpaywall(response);
        if (shouldAvoidUnpaywallLiveCall) {
          return
        }

        var endpoint = getUnpaywallEndpoint(scope);
        if (endpoint && isUnpaywallEnabled()) {
          var requestUnpaywall = new XMLHttpRequest();
          requestUnpaywall.open("GET", endpoint, true);
          requestUnpaywall.setRequestHeader("Content-type", "application/json");

          requestUnpaywall.onload = function() {
            if (requestUnpaywall.readyState == XMLHttpRequest.DONE && requestUnpaywall.status == 200) {
              var responseUnpaywall = JSON.parse(requestUnpaywall.response);

              if (shouldIgnoreUnpaywallResponse(response, responseUnpaywall)) {
                return;
              }

              var unpaywallArticlePDFUrl = getUnpaywallArticlePDFUrl(responseUnpaywall);
              var unpaywallArticleLinkUrl = getUnpaywallArticleLinkUrl(responseUnpaywall);
              var unpaywallManuscriptArticlePDFUrl = getUnpaywallManuscriptArticlePDFUrl(responseUnpaywall);
              var unpaywallManuscriptArticleLinkUrl = getUnpaywallManuscriptArticleLinkUrl(responseUnpaywall);
              var articleRetractionUrl = getArticleRetractionUrl(scope, data);
              var articleEocNoticeUrl = getArticleEOCNoticeUrl(scope, data);
              var problematicJournalArticleNoticeUrl = getProblematicJournalArticleNoticeUrl(scope, data);

              var template;
              var pdfAvailable = false;

              if (unpaywallArticlePDFUrl && browzine.articlePDFDownloadViaUnpaywallEnabled) {
                template = unpaywallArticlePDFTemplate(unpaywallArticlePDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl);
                pdfAvailable = true;
              } else if (unpaywallArticleLinkUrl && browzine.articleLinkViaUnpaywallEnabled ) {
                template = unpaywallArticleLinkTemplate(unpaywallArticleLinkUrl);
              } else if (unpaywallManuscriptArticlePDFUrl && browzine.articleAcceptedManuscriptPDFViaUnpaywallEnabled) {
                template = unpaywallManuscriptPDFTemplate(unpaywallManuscriptArticlePDFUrl, articleRetractionUrl, articleEocNoticeUrl, problematicJournalArticleNoticeUrl);
                pdfAvailable = true;
              } else if (unpaywallManuscriptArticleLinkUrl && browzine.articleAcceptedManuscriptArticleLinkViaUnpaywallEnabled) {
                template = unpaywallManuscriptLinkTemplate(unpaywallManuscriptArticleLinkUrl);
              }

              if (template) {
                var element = getElement(scope);

                (function poll() {
                  var elementParent = getElementParent(element);
                  var availabilityLine = elementParent.querySelector("prm-search-result-availability-line .layout-align-start-start");

                  if (availabilityLine) {
                    availabilityLine.insertAdjacentHTML('afterbegin', template);
                  } else {
                    requestAnimationFrame(poll);
                  }
                })();
              }

              if (!showLinkResolverLink() && template) {
                var element = getElement(scope);

                (function poll() {
                  var elementParent = getElementParent(element);
                  var contentLinkElement = elementParent.querySelector("prm-search-result-availability-line .layout-align-start-start .layout-row");

                  if (contentLinkElement) {
                    contentLinkElement.remove();
                  } else {
                    requestAnimationFrame(poll);
                  }
                })();
              }

              if (template) {
                var element = getElement(scope);

                (function poll() {
                  var elementParent = getElementParent(element);
                  var quickLinkElement = elementParent.querySelector("prm-quick-link");

                  if (quickLinkElement) {
                    quickLinkElement.remove();
                  } else {
                    requestAnimationFrame(poll);
                  }
                })();
              }
            }
          };

          requestUnpaywall.send();
        }
      }
    };

    request.send();
  };

  return {
    searchResult: searchResult,
    urlRewrite: urlRewrite,
    libraryIdOverride: libraryIdOverride,
    getResult: getResult,
    isArticle: isArticle,
    isJournal: isJournal,
    getIssn: getIssn,
    getDoi: getDoi,
    isFiltered: isFiltered,
    getEndpoint: getEndpoint,
    getUnpaywallEndpoint: getUnpaywallEndpoint,
    shouldEnhance: shouldEnhance,
    getData: getData,
    getIncludedJournal: getIncludedJournal,
    getBrowZineWebLink: getBrowZineWebLink,
    getCoverImageUrl: getCoverImageUrl,
    getBrowZineEnabled: getBrowZineEnabled,
    isDefaultCoverImage: isDefaultCoverImage,
    getDirectToPDFUrl: getDirectToPDFUrl,
    getUnpaywallUsable: getUnpaywallUsable,
    getArticleLinkUrl: getArticleLinkUrl,
    getArticleRetractionUrl: getArticleRetractionUrl,
    getArticleEOCNoticeUrl: getArticleEOCNoticeUrl,
    isUnknownVersion: isUnknownVersion,
    isTrustedRepository: isTrustedRepository,
    getUnpaywallArticlePDFUrl: getUnpaywallArticlePDFUrl,
    getUnpaywallArticleLinkUrl: getUnpaywallArticleLinkUrl,
    getUnpaywallManuscriptArticlePDFUrl: getUnpaywallManuscriptArticlePDFUrl,
    getUnpaywallManuscriptArticleLinkUrl: getUnpaywallManuscriptArticleLinkUrl,
    showJournalCoverImages: showJournalCoverImages,
    showJournalBrowZineWebLinkText: showJournalBrowZineWebLinkText,
    showArticleBrowZineWebLinkText: showArticleBrowZineWebLinkText,
    showDirectToPDFLink: showDirectToPDFLink,
    showArticleLink: showArticleLink,
    showPrintRecords: showPrintRecords,
    showRetractionWatch: showRetractionWatch,
    showExpressionOfConcern: showExpressionOfConcern,
    showFormatChoice: showFormatChoice,
    showLinkResolverLink: showLinkResolverLink,
    enableLinkOptimizer: enableLinkOptimizer,
    transition: transition,
    directToPDFTemplate: directToPDFTemplate,
    articleLinkTemplate: articleLinkTemplate,
    retractionWatchLinkTemplate: retractionWatchLinkTemplate,
    eocLinkTemplate: eocLinkTemplate,
    browzineWebLinkTemplate: browzineWebLinkTemplate,
    unpaywallArticlePDFTemplate: unpaywallArticlePDFTemplate,
    unpaywallArticleLinkTemplate: unpaywallArticleLinkTemplate,
    unpaywallManuscriptPDFTemplate: unpaywallManuscriptPDFTemplate,
    unpaywallManuscriptLinkTemplate: unpaywallManuscriptLinkTemplate,
    isUnpaywallEnabled: isUnpaywallEnabled,
    getElement: getElement,
    getElementParent: getElementParent,
    getScope: getScope,
  };
}());
Ә,          m      browzine   C      primo      B2	      libraryId      YY$      api    hn      libraryIdOverride      G%
      urlRewrite     Sן      apiKey     E      indexOf    l      staging-api.thirdiron.com	            public-api.thirdiron.com
   Q      api.thirdiron.com      5O      override   -      baseUrl    v<]@      https://public-api.thirdiron.com/public/v1/libraries/{libraryId}   ER      {libraryId}    x	      getResult      	      scope      ̺      item   0	      isArticle      zw
      validation     QB      pnx    e}      display    Y      contentType    b      trim   RDo      toLowerCase    I`      article    A	      isJournal      >Q      journal    f      getIssn    r      issn   #"      addata     >	      filter      ~-|      [\S]{4}\-[\S]{4}!   ?v      eissn"      eN      getDoi#     h      doi$    k      getEndpoint%    m9      endpoint&   ya      /search?issns='     ඌ      /articles/doi/(     mu)      ?include=journal,library)   [Ur      &access_token=*     .2      getUnpaywallEndpoint+   <      email,            unpaywallEmailAddressKey-   Ļ      https://api.unpaywall.org/v2/.      fzb      ?email=/    ϟ      getData0    O      response1   6(      data2   ]      isArray3          browzineEnabled4    i4      pop5    Q      getIncludedJournal6           included7   O      getBrowZineWebLink8     )ȱ      browzineWebLink9    p      getCoverImageUrl:   -      coverImageUrl;      4      getBrowZineEnabled<     U0h4      isDefaultCoverImage=    .      defaultCoverImage>      aOJ      getDirectToPDFUrl?      w	>      directToPDFUrl@     o      fullTextFileA   Zg      getUnpaywallUsableB     @/      unpaywallUsableC    ~4      getArticleLinkUrlD      W37      articleLinkUrlE     T
      contentLocationF    Ŵ      getArticleRetractionUrlG    0      articleRetractionUrlH   @+      retractionNoticeUrlI          getArticleEOCNoticeUrlJ     dv      articleEocNoticeUrlK          expressionOfConcernNoticeUrlL   EW%      getProblematicJournalArticleNoticeUrlM      i"      problematicJournalArticleNoticeUrlN     vhe      isTrustedRepositoryO    c      best_oa_locationP   U      url_for_pdfQ    /      nih.govR    #"      europepmc.orgS      O      isUnknownVersionT   _      versionU    Sq      getUnpaywallArticlePDFUrlV      Ł	      host_typeW      &	      publisherX      KD
      repositoryY     aU      publishedVersionZ    g      getUnpaywallArticleLinkUrl[     u      url_for_landing_page\   2#      getUnpaywallManuscriptArticlePDFUrl]          acceptedVersion^    g$      getUnpaywallManuscriptArticleLinkUrl_   b      showJournalCoverImages`           featureEnableda     ~4      configb     gX      journalCoverImagesEnabledc      Vڙ.      showJournalBrowZineWebLinkTextd     
!      journalBrowZineWebLinkTextEnablede      g      showArticleBrowZineWebLinkTextf     !      articleBrowZineWebLinkTextEnabledg      9      showDirectToPDFLinkh    H       articlePDFDownloadLinkEnabledi      L|      prefixConfigj   "      primoArticlePDFDownloadLinkEnabledk     @      showArticleLinkl    q%      articleLinkEnabledm     eo      showPrintRecordsn   y      printRecordsIntegrationEnabledo     v^      showRetractionWatchp    nO      articleRetractionWatchEnabledq      ,w{      showExpressionOfConcernr    0!      articleExpressionOfConcernEnableds      '      showFormatChoicet   I      showLinkResolverLinku   dW      enableLinkOptimizerv    }*%f
      isFilteredw     0w      deliveryx   4      deliveryCategoryy         alma-pz     
      transition{     IIP      event|      r      anchor}     B9      preventDefault~     /F/      stopPropagation    2      window     x5      open   `X      href   y      showRetractionWatchUI      z      showEocNoticeUI    H%      showProblematicJournalArticleNoticeUI      Y      directToPDFTemplate    f=      pdfIcon    O      https://assets.thirdiron.com/images/integrations/browzine-pdf-download-icon.svg    <      pdfIconWidth         pdfIconMarginRight     <      4.5px      D      articlePDFDownloadLinkText     jr`      primoArticlePDFDownloadLinkText    V"      Download PDF   !S      https://assets.thirdiron.com/images/integrations/browzine-retraction-watch-icon.svg    SK      1.5px      2      articleRetractionWatchText     +      Retracted Article      GE      articleExpressionOfConcernText           Expression of Concern      v6      problematicJournalText     _      Problematic Journal    s      template   D+      {directToPDFUrl}   <      {articlePDFDownloadLinkText}   m5_	      {pdfIcon}      O7      {pdfIconWidth}           {pdfIconMarginRight}         articleLinkTemplate    N*[      linkIcon    XO      https://assets.thirdiron.com/images/integrations/browzine-article-link-icon.svg    7      linkIconWidth      <      linkIconMarginRight    v15      articleLinkText    .`      Read Article   I@      {articleLinkUrl}   e      {articleLinkText}      H0
      {linkIcon}     DB      {linkIconWidth}    L      {linkIconMarginRight}      D      retractionWatchLinkTemplate    $      eocLinkTemplate    
+      problematicJournalArticleNoticeLinkTemplate    d      browzineWebLinkTemplate    k      browzineWebLinkText    $Z      bookIcon   L      https://assets.thirdiron.com/images/integrations/browzine-open-book-icon.svg   <      journalBrowZineWebLinkText     y      primoJournalBrowZineWebLinkText    h      View Journal Contents            articleBrowZineWebLinkText     u-      primoArticleBrowZineWebLinkText    @       View Issue Contents    ߇      {browzineWebLink}      .j      {browzineWebLinkText}      ]r
      {bookIcon}     fȯ      unpaywallArticlePDFTemplate    |A"      articlePDFDownloadViaUnpaywallText     s^      Download PDF (via Unpaywall)   b:P      unpaywallArticleLinkTemplate   ϼ      articleLinkViaUnpaywallText    s0$      Read Article (via Unpaywall)   _<      unpaywallManuscriptPDFTemplate     :u,      articleAcceptedManuscriptPDFViaUnpaywallText   Q0      Download PDF (Accepted Manuscript via Unpaywall)   AGR      unpaywallManuscriptLinkTemplate    4      articleAcceptedManuscriptArticleLinkViaUnpaywallText   J0      Read Article (Accepted Manuscript via Unpaywall)   y      isUnpaywallEnabled     l%      articlePDFDownloadViaUnpaywallEnabled      y      articleLinkViaUnpaywallEnabled     G/      articleAcceptedManuscriptPDFViaUnpaywallEnabled    m7      articleAcceptedManuscriptArticleLinkViaUnpaywallEnabled     
      getElement     ё      $element   s      getElementParent   t      offsetParent   *      getScope   )      $scope     (0      $ctrl      +.
      parentCtrl     L.1      $parent    ~0      shouldEnhance      |f      shouldAvoidUnpaywall   O3D      avoidUnpaywall     4      shouldIgnoreUnpaywallResponse      :c      unpaywallResponse       Z      avoidUnpaywallPublisherLinks   耯0      searchResult   l(      request    $      XMLHttpRequest     ř
      GET    f      setRequestHeader   mDo      Content-type   2Sb3      application/json   {p      onload     U
      readyState     3hw      DONE   5      parse      E(      libKeyLinkOptimizer    O      document   DC      createElement            div    6CY>	      className      5E.      libkey-link-optimizer      +      display: flex; justify-content: flex-start;    Q:	      innerHTML      <m      poll   ]      elementParent      4ŀ0      availabilityLine  1:      querySelector     c(=      prm-search-result-availability-line .layout-align-start-start     Aݑ      insertAdjacentHTML    10K
      afterbegin    v(	      outerHTML     R      requestAnimationFrame     B-      append    
      coverImages	   #      querySelectorAll
  uPq)      prm-search-result-thumbnail-container img     V      fan-img   -
      coverImage    ț      src   U      contentLinkElement    bnI      prm-search-result-availability-line .layout-align-start-start .layout-row     *N      remove          quickLinkElement  '      prm-quick-link    eb      {}          shouldAvoidUnpaywallLiveCall  Ҹ      requestUnpaywall  7k      responseUnpaywall     d
      unpaywallArticlePDFUrl    1      unpaywallArticleLinkUrl   /       unpaywallManuscriptArticlePDFUrl  BX!      unpaywallManuscriptArticleLinkUrl     P      pdfAvailable  ,      send  pl[     <div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'><a class='browzine-direct-to-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'><img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> <span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> <md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon></a></div>     7,     <div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'><a class='browzine-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'><img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: {linkIconMarginRight};' aria-hidden='true' width='{linkIconWidth}' height='16'/> <span class='browzine-article-link-text'>{articleLinkText}</span> <md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon></a></div>     H     <div class='browzine' style='line-height: 1.4em;'><a class='browzine-web-link' href='{browzineWebLink}' target='_blank' onclick='browzine.primo.transition(event, this)'><img alt='BrowZine Book Icon' src='{bookIcon}' class='browzine-book-icon' style='margin-bottom: -2px; margin-right: 2.5px;' aria-hidden='true' width='15' height='15'/> <span class='browzine-web-link-text'>{browzineWebLinkText}</span> <md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2٘&g,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon></a></div>   >     <div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'><a class='unpaywall-article-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'><img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> <span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> <md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon></a></div>!  *Bܽ     <div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'><a class='unpaywall-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'><img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: 4.5px;' aria-hidden='true' width='12' height='16'/> <span class='browzine-article-link-text'>{articleLinkText}</span> <md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon></a></div>"     R^     <div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'><a class='unpaywall-manuscript-article-pdf-link' href='{directToPDFUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'><img alt='BrowZine PDF Icon' src='{pdfIcon}' class='browzine-pdf-icon' style='margin-bottom: -3px; margin-right: {pdfIconMarginRight};' aria-hidden='true' width='{pdfIconWidth}' height='16'/> <span class='browzine-web-link-text'>{articlePDFDownloadLinkText}</span> <md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon></a></div>#   &exD     <div class='browzine' style='line-height: 1.4em; margin-right: 4.5em;'><a class='unpaywall-manuscript-article-link' href='{articleLinkUrl}' target='_blank' onclick='browzine.primo.transition(event, this)'><img alt='BrowZine Article Link Icon' src='{linkIcon}' class='browzine-article-link-icon' style='margin-bottom: -3px; margin-right: 4.5px;' aria-hidden='true' width='12' height='16'/> <span class='browzine-article-link-text'>{articleLinkText}</span> <md-icon md-svg-icon='primo-ui:open-in-new' class='md-primoExplore-theme' aria-hidden='true' style='height: 15px; width: 15px; min-height: 15px; min-width: 15px; margin-top: -2px;'><svg width='100%' height='100%' viewBox='0 0 24 24' y='504' xmlns='http://www.w3.org/2000/svg' fit='' preserveAspectRatio='xMidYMid meet' focusable='false'><path d='M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z'></path></svg></md-icon></a></div>$  ?      browzine.primo<%   .j       getIssn/issn<&     j      getData/data<'      ؏z      searchResult/request.onload)   BA      searchResult/request.onload/<*     ]3      searchResult/request.onload/requestUnpaywall.onload     J   t  O   J   1          %,                              =                                                                                                                                           	                 
                                                                                                                                                                                                                                                                                                                                                                                                        !                 "                 #                 $                 %                 &                 '                 (                 )                 *                 +                 ,                 -                 .                 /                 0                 1                 2                 3                 4                 5                 6                 7                 8                 9                 :                 ;                 <                 =                 >                 ?                 @                A      A          B      B                C           C      B                E           D      F           E      B          F      H                I           G      H                K           H      H                M           I      Oc            @                P  P;  P    PU  P  Po  PZ  P  Pg  P  Pt  P  P_  P  P  P5  P  q  P  P  P  P\  Pv  P  P*  P  PL  P7  P"  P/  P  Ps  P<  P  ^  PI  P  Pk  P  P  PA  Pc  P  P  PN  P  P9  P  $  PF  P  PS  Pu  P>  P  Pm  P  P  Pz  C  Pe  P  P             <              <                                                                                                                             #                  %    #                %  +  #              0  1                             0                1  8                1    :                1    3              :  =                1  ?                 1                1  D                1  G                1  J                1  M              0                0                0  <              0  <              0  <              0  <                `  a                `  a                `  a                `  a  i                `  a                `  a                `  a                `  a                `  a                `  a                `  a                    x               {  |               G               J               M  	            ?  G  J  M            	            D  G  J  M                        G  D                        J  D                        M  D                          8        	            ?  G  J  M                        D        	            ?  G  J  M                        D                                                                                                    0               0                    P%    P              0  P1  P  8  :  P3  =  ?  B  D  G  J  M    `  P       %   P                                                                            	                G  J  M    P   `                                                                                        0            -            -                                                                                                                                                                                                                                 I$KE        6                     "  v  $  *    /  5  7  9  ;  <  >  A  C  F  I  S  N  U  Z  \  ^  _  c  e  g  k  m  o  q  s  t  u  z                            &ժ!!J   @     9@                                m    s  L   ߥ`K PP  JQ           
       ?        m     m      m    2  m    %  m       m    +  m      m    0  m	      m
      m      m      m    /  m      m    "  m    5  m    )  m    :  m    1  m    $  m      m    -  m    3  m      m    	  m      m    #  m      m    *  m    ;  m      m     &  m!    7  m"      m#      m$    !  m%      m&    4  m'      m(     m)    6  m*      m+      m,    ,  m-      m.      m/    
  m0    .  m1      m2    8  m3    <  m4      m5      m6      m7      m8    (  m9      m:      m;    '  m<    9  m=     ߻>   J?     ߾       >   J@   s s    ߻>   JA      9B     <C     <D      <E    2  <F    %  <G       <H    +  <I      <J      <K    0  <L      <M      <N      <O      <P      <Q    /  <R      <S    "  <T    5  <U    )  <V    :  <W    1  <X    $  <Y    3  <Z    -  <[      <\    	  <]      <^    #  <_      <`    *  <a    ;  <b      <c    &  <d    7  <e      <f      <g    !  <h      <i    4  <j     <k    ,  <l      <m      <n    
  <o      <p    8  <q    <  <r      <s      <t      <u      <v    (  <w      <x    `/`
PP)`0000.0?0`0o0  0  0  0  0  0  0  0  0  0  0 
0 0 80 D0 T0 d0 t0 0 0 0 0 0 0 0 0 0 0 0 0 0  0 W0 0 0 0 0 0 0 %0 P0 c0 0 0  `%)))*************************************)************Q   'Π                                     -        J      s              J      s    	     !   	     J         s     	`-`AK`P `CF`P 5P(Q   ژ   V                             ߻   J     ߾  0           ߾  J   l     s    ߗ       `(`O	`.`*`PM	`$QL   L   "                           J         ߼  J       ` Q0  ?50                              2     s   ߾        ߾  J              J   J         ߾  J   J   J   
   ^        J   J   J   KJ   s  J   s    ߾  J      s          ߗ       `&`
PH	` ` ` P
PH` P `K`$Q0  ?50                              2     s   ߾        ߾  J              J   J         ߾  J   J   J   
   ^        J   J   J   KJ   s  J   s    ߾  J      s          ߗ       `&`
PH	` ` ` P
PH` P `K`$Q$  Gó$  u                O              2     s   ߾  -      ߾  J         ߾  J   J             J   J   J           J   J   J   J   c        J   J   J   J   m   s J   	   s J
   s  J   l      s    ߙa        J   J   J   KB   !     J   J   J   KJ
   s  J         s    ߗ)     J   J   J      -   ߾   .      /     J   J   J   J   c   5     J   J   J   J   m   s J   	   s J
   s  J   l      s    ߙa   @     J   J   J   KB   E     J   J   J   KJ
   s  J         s    ߗM          s  `*`
PH	` ` ` ` %PJ	U

P

P ` ` !P PM`  ` ` &PJU

P

P ` ` "P PM`P#Q`   ^O`   /                           J   
      l   J     s     ` 6P(Q`   ^O`   /                           J   
      l   J     s     ` 6P(Q(  o5~(                                 2     s   ߾        ߾  J              J   J         ߾  J   J   J   
   M        J   J   J   K.        J   J   J   KJ   s     ߗ          s  `*`
PH	` ` ` ` PM`P#Q  iO  [                                    s        +     s    0       +     s         &  &   ߗ    %     s    	         s 
   6            s         &  &   &   ߗ    %     s /            s        +     s    0       +     s         &  &   ߗ            &&.   ߾    `J	`
P P `P(`$O	`
P P `P(`$@	`
PP P `P(`$O`	M`$Q   J                              J      %     s &            s       ߾     5            s        &   &  &   ߗ       `O	`
P P `P(`-O	`$Q      s                        9      ߻   J     J   s 5        J   J   m   s J   s     ߙ        J      ߗ       `J	`P-`PJ
P `@`$Q4   ;ɋi4                              J    	`*Q   ؘe   j                 
          ߼  J   Q         J     J   s         J   K   	     J   
      ߗ
       `F	` `P@`$Qx   dx   C                           ߼        ߼  J              J      ߗ       `F	` `@`$Q  I0  _                                 s        +     s    <             ߼ J             J      ߗ    %     s    
         s    <             ߼ J             J      ߗ    %     s /            s        +     s    <             ߼ J             J      ߗ       `F	`
P P ` 	`@		`
P P ` 	`@	`
PP P ` 	`@`$Q   i*                                     s <             ߼ J             J      ߗ    %     s <          	   ߼ J   
          J      ߗ       `F	`
P-` 	`@		`
P-` 	`@`$Q   +.   S                           ߼  *      ߼  J   s  J      s             ߗ       `F	` PP `K`$Q   -   Y                            %     s <             ߼ J             J      ߗ       `F	`
P-` 	`@	`$Q   aI&   a                          %     s                 ߼ J      s              J    	`P-`AF	`	P `AF`  *Q   -   Y                            %     s <             ߼ J             J      ߗ       `F	`
P-` 	`@	`$Q   B   Y                            %     s <             ߼ J             J      ߗ        `F	`
P-` 	`@	`$Q   Ys6   Y                            %     s <             ߼ J             J      ߗ       `F	`
P-` 	`@`$Q   4   Y                            %     s <             ߼ J             J      ߗ       .`F	`
P-` 	`@`$Q                                 ߼  J         ߼  J   J      h        J   J   J      s *      ߼  J   J   J      s             ߗ       `F	` ` &P AP 	`K	`$Q   >>   d                 
          ߼  J   K        J   J         ߼  J   J      	      
      ߗ
       `F	` ` 	`K	`$Q(  ?g(                            J           J   J            ߼  J   J      	      
     J   J      .       3     s        -     s    3        J   J           J   J      ߗ      @	` ` ` NP 2P ` `@`$Q   	H                             J           J   J            ߼  J   J      	   P   
     J   J      3        J   J           J   J      ߗ      @	` ` ` ` `@`$Q  j                            J           J   J              J   J      /   
    3     s        -     s    3        J   J           J   J      ߗ      @	` ` ` MPP ` `@`$Q   Ʊ                             J   m        J   J      P        J   J      3   
     J   J           J   J      ߗ      @	` ` ` ` `@`$Q   팔   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O	` `K`$Q   팔   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O	` `K`$Q   팔   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O	` `K`$Q   i                               ߻   J     ߻   J     ߾   "      ߾        ߾  	      
      ߗ
     "      ߾        ߾              ߗ       `&`/`O	` `K		` `K`$Q   팔   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O	` `K`$Q   팔   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O	` `K`$Q   팔   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O	` `K`$Q   \kX   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O` `@`$Ql   he0l   6                            ߻   J     ߾           ߗ       `&`O	` `K`$Q   팔   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O	` `K`$Q   팔   ]                            ߻   J     ߾   "      ߾        ߾              ߗ       `&`O	` `K`$Q<  M<                              2     s   ߾        ߾  J              J   J          ߾  J   J   J      g        J   J   KJ   s  J   s    ߾            7   s              ߗ       `&`
PH	` `  ` $P
PH` !P `K`$Q   wy   ?                  	         J   w  ߼  J   w  ߻   J    J    J   w @`
P$`
PD`PD
`!QL   mL                                        s      ` P(QL   L                                        s      ` P(Q4   4                               `  %Q  3o  (         	                              ߻   J   %      ߻   J                  6    s X               	     
     ߻   J                 ߙ           s X               	     
     ߻   J                 ߙi           s S               	     
     ߻   J                 ߗ        ߾  J   l     s   ߾  J   l     s   ߾  J   l      s   ߾  J   l     s   ߾  J   l     s   ߾   `*`*`*&`@	`P-`'`*`*`*` `P-`'`*`*`*` `&P-`'`*`*`*`@`J"`P(`!P(`P(`P(`PH(`$Q             	                              ߻   J                  6    s X                    	     ߻   J
                 ߙ           s X   
                 	     ߻   J                 ߙi           s S                    	     ߻   J                 ߗ        ߾  J   l     s   ߾  J   l     s   ߾  J   l      s   ߾  J   l     s   ߾  J   l     s   ߾   `*`*`*`@	`P-`'`*`*`*` `P-`'`*`*`*` `&P-`'`*`*`*`@`J"`P(`P(`P(`P(`PH(`$Qd  Q;d            
                                  ߻   J                      ߾  J   l	      s   ߾  J   l
     s   ߾  J   l     s   ߾  J   l     s   ߾  J   l     s   ߾   `(`*`*`*`@`J`P(`P(`P(`P(`PH`$Qd  Q;d            
                                  ߻   J                      ߾  J   l	      s   ߾  J   l
     s   ߾  J   l     s   ߾  J   l     s   ߾  J   l     s   ߾   `(`*`*`*`@`J`P(`P(`P(`P(`PH`$Qd  Q;d            
                                  ߻   J                      ߾  J   l	      s   ߾  J   l
     s   ߾  J   l     s   ߾  J   l     s   ߾  J   l     s   ߾   `(`*`*`*`@`J`P(`P(`P(`P(`PH`$Q  r`'                                           s C         J   %      ߻   J                  ߗ    %     s C   
      J   %      ߻   J         	         ߗ   
     ߾  J   l    s   ߾  J   l      s   ߾  J   l     s   ߾   `*`J	`
P-`@	`
P-`@`J`P(`P(`PH`$Q  Rq           	                              ߻   J                  6    s X                    	     ߻   J
                 ߙ           s X   
                 	     ߻   J                 ߙi           s S                    	     ߻   J                 ߗ        ߾  J   l     s   ߾  J   l     s   ߾  J   l      s   ߾  J   l     s   ߾  J   l     s   ߾   `*`*`*&`@	`P-`'`*`*`*` `P-`'`*`*`*` `&P-`'`*`*`*`@`J"`P(`!P(`P(`P(`PH(`$Q   C                    	             ߻   J                      ߾  J   l     s   ߾  J   l     s   ߾  J   l	      s   ߾   `*`@`J`P(`P(`PH`$Q  $           	                              ߻   J                  6    s X                    	     ߻   J
                 ߙ           s X   
                 	     ߻   J                 ߙp           s Z                        	     ߻   J                 ߗ        ߾  J   l     s   ߾  J   l     s   ߾  J   l      s   ߾  J   l     s   ߾  J   l     s   ߾   `*`*`*&`@	`P-`'`*`*`*` `P-`'`*`*`*` `&P-`.`*`*`*`@`J"`P(`!P(`P(`P(`PH(`$Q   C                    	             ߻   J                      ߾  J   l     s   ߾  J   l     s   ߾  J   l	      s   ߾   `*`@`J`P(`P(`PH`$Qx   Fx   P                             J   ?      ߻   J   *      ߻   J      	   ߻   J       ` Q4   =4   
                           J    `(QL   UL   !                           KJ         ߼  K    ` Q  b(                  *         H      ߼  J   5      ߼  J   J         ߼  J   J   J   	   !   
     J   J      ߙ       H      ߼  J   5      ߼  J   J         ߼  J   J   J      !        J   J      ߙ        j      ߼  J   W      ߼  J   J   ?      ߼  J   J   J   "   "   ߼  J   J   J   J   &   !   '     J   J   J      ߗ*      @	`@` `@` `@`@ `$Q|  rcH|                                   s              s        +     s             ߗ    %     s             s 	      
      ߗ
    %     s /            s        +     s             ߗ       `F	`P-`
P P 	`K`
P P 	`K`
PP P 	`K`$Q   9   c                  	         J      s "      ߼  J   J      s            J   J      	   	    	`	P (P `M; `A6 P   %                              J      s "      ߼  J   J      s    A       J      	   ߼ J   J                   	`	P (P ` 	`AF`!Q$  om$                               s          s           0      s    ߻             J         w    J         w    m   L      J	   w  ߥ `	PI	`P-`A  F`PH	` ` P$` PD`@  `P$P  .7  	                          J      J           J       F        J     J   s          s          s          s   /           s               s   "      s   5        s   )        s   :        s   1        s   $        s           s 	       s    ߻   J	   
   s          L         L   ߾  -      %     s    !      s  "   ?   #   ,         	  s 
     J   
  &.L   ߗ'     D   )   !   s  0   +   ߾      -   ߾     /   ߾	  0   P   1   ߾  A   2   %     s (   4      s     6   &   s  7   ?   8            	  s 
     J   
  &.L   ߗ<     L   >   ߾  <   @   ߾  -   A   %     s    C      s  D   3   E        s 
     J   
  &.L   ߗI     \   K   ߾  L   M   ߾  <   O   ߾  -   P   %     s    R      s  S   3   T   
     s 
     J   
  &.L   ߗX     X   Z   ߾  H   \   ߾  8   ^   ߾  (   `   ߾	     a   %     s b   3   c   .   	  s 
     J   
  &.L   ߗg      J      i   m    w  ߗj     <   k   ߾  -   l         s    n   *   s  o   5   p          s 
     J   
  w ߗs     _   t   ߾  P   u   %     s 7   w   ߾     x   ߾  x      y   ;   s  z   5   {          s 
     J   
  w ߗ~      $      ߾           s           m    w  ߗ      s        ߾        ߾     R      (      s   ߾  J      s   ߾          J   w  ߗ           ߾           4   s     R      (      s   ߾  J      s   ߾          J   w  ߗ     J      J           J      H      %     s /      ߾        ߾        ߾             J     J               s    '      s   ߾                 s   ߾           s     q                   J        w    J         w    m   L      J   w  ߗ    `
 `
PI`P)`PH`P(`P)`P(!`P(`P(`P(`P($`P(#`P(2`&PH`PI#` 	P)	` 	`@` P P `P(`@` P   EP P P `P(`@"`  5P P `P(`@'`   :P P `P(`@,`    HP `,P(`@1` `F;PI>` 0P P `P(`PIC` 0P :P `P(`PIH`  P `FTPIW`P `P($` PH[`.`PI`` %P `P("` PHd`.`PIj`
 <P @l` P),`P(`.`A  Fr`P(` P "` ` P$` PDx`@  `P P   z   r                	        (      s    ߾   J      s   ߾  -        J         J   w ߙ          w ߗ	    !`P($` PH`.` 2
P `PI	P                            (      s    ߾   J      s   ߾  9      ߾  K(      ߾  KJ   J      s    2         J   J	   J
     m   w ߙ          w ߗ    !`P(` PH` :P ` P> `PIP8   8O/8                                 L   ߥ `.P8  !ئ8        	          5          J      J           J               J     J   s    9        s                 s   	      s         s   #      s   1       s   $       s          s     ߾        ߻   J	      4      8           s      ߙ              ߻   J
      "      <     s    ߙ               ߻   J   "   4   #              s      ߙE   $        %   ߻   J   '      (        s    ߗ)      (   *        s    m    w  ߗ,      s     /      /   (   0        s    m    w  ߗ2      (   3        s    m    w  ߗ5    `
 '`
PH`
P-`ALF,`P(-`P(6`$P(7`%P(*`P()`P(8`&P8 "`F` `'P)` ` `(P ` `*"P)` ` `+PN`/`PI"`F+PI.`P `PI1`F:PI=`/`PI@`FIPILP   7X_   m                        (      s    ߾   J      s   ߾  (        J         w ߙ          w ߗ    '`P(*` PH`.` 2P `PI	P   'ʰ   c                        (      s    ߾   J      s   ߾          J   w  ߙ          w ߗ    '`P(,` PH`.`P `PI	P   ԰   c                        (      s    ߾   J      s   ߾          J   w  ߙ          w ߗ    '`P(*` PH`.`P `PI	P3  `    	    
    `            P  `      `    "            `    "            `@    P  	  `@    P    `         @      p5  ,        P-  !  	  p  P   
  `       #         `   &  '  (  )    `   ,  -  .    `3    `   @r  2  1      p4    `6  r  2    `8    `:    `3    `    i     `@    `   B    `E    `H    `K    `M    `O  P    Q  R    `O  T       `O  V  W  X  T  Y  P    `O  V  W  X  T  Y  P  [    `O  V  X  T  ]  P    `O  V  X  T  ]  P  [     `   b  !  `   d  "  `   f  #  `   h  j  $  `   l  %  `   n  &  `   p  '  `   r  (  `   s  )  `   t  *  `   u  +  `w  x  @      y  ,  `}  ~          -  `.  `/  `0  `  B               E                     P  P  P  P	  P1  `  B             E                   
  P  P  P  P  P2  `  E                P  P  P  P  P3  `  E                P  P  P  P  P4  `  E                P  P  P  P  P5  `                         P  P   P6  `  B             E                    !  P"  P#  P$  P%  P7  `         !   &  P'  P(  P8  `  B             E            D      "   )  P*  P+  P,  P-  P9  `         #   .  P/  P0  P:  `           ;  `  <  `  =  `        >  `?  `   U    @  `   1    O  V  W  C  `D  `      G  ` E  `F  `	 
      r       4   E  p I  `J  `     K  `L  `    M  `N  `    H  `        t    0             G  pH  pI  pB  `        t    0                  C  p D  p               F  p   A  `            B  p     `  p  p  p  p  p  p
  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p   p!  p"  p#  p$  p%  p&  p'  p(  p)  p*  p+  p,  p-  p.  p/  p0  p1  p2  p3  p4  p5  p6  p7  p8  p9  p:  p;  p<  p=  p>  p?  p@  pA  p           @              "  v  $  *    /  5  7  9  ;  <  >  A  C  F  I  S  N  U  Z  \  ^  _  c  e  g  k  m  o  q  s  t  u  z                               `     p  Xp                  y   $                                                                              '                    %       #      %       9      "        @      $        F      *        M      /        K      &       U      5        Y      7        [      9        ]      ;        _      <        c      >        e      A        h      C        j      F        l      I        n      L        p      N        v      S        z      U           	   Z              \              ^              _              c              e              g              k              m              o              q              s              t              u              v              z                                                                                            
                          &             5             L  
           V             n  
           x             ~                                                                                
                 '                                      )            *                                              H      I      I                   D     D                                                                    0    0                 G    5                      F    F  1              [  o
  K  o
  B               ]    U    I   8            	  x	  	  x	  U   9            
    t
    c                       r                 "    "                 7  ;  '  ;                            +            [    @                   9                                              ?    $                                                                   h    h                   Y  m  Y                ~  j  ^  j    #                o      "                    $  1              [    [  /              y  h  `  h  ;                y!  m  y!  G  %            !  T#  ~!  T#  W  &            #  8%  Y#  8%  g  /            j%  &  =%  &  w  0            	'  '  &  '    "             !(  )  '  )    *             A)  5*  )  5*    *             V*  ,  :*  ,                 .,  -  ,  -                 1-  ".  -  ".                 C.  3/  '.  3/                 X/  L0  8/  L0    #             j0  1  Q0  1                 ;1  "2  1  "2                  C2  )3  '2  )3                 A3  4  .3  4                5  6   5  6                6  J7  6  J7  #  !            g7  7  O7  7  '              7  L8  7  L8  +  1            l8  D  P8  D  /              D  |P  D  |P  Z              P  X  P  X    '            !X  _  	X  _                _  8g  _  8g    7            ^g  n  >g  n    #            n  z  n  z    '            h{    C{      (            ҁ        (  *            :        S  +            Д        f               ֕    Õ    j                ]    ]  n              s  	  b  	  r              $                        x    x                   ՞  |  ՞    )              ٞ                +    #                   3  Ҭ  &  Ҭ                5  0  (  0                   ԰  ~  ԰    A            g    g  ?  -             I    <    a                 L    L  p                 9    9               5YRm      gIgIG.SgY   t    O^partitionKey=%28https%2Chelsinki.fi%29,:https://s3.amazonaws.com/browzine-adapters/primo/browzine-primo-adapter.js necko:classified 1 strongly-framed 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAAAAgAAAAAAAAAAAAAAAAAAAAEAOQFmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAhAMIIIPDCCBySgAwIBAgIQD/CWznQSJrTnMP3Zzx6aVzANBgkqhkiG9w0BAQsFADA8MQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRwwGgYDVQQDExNBbWF6b24gUlNBIDIwNDggTTAxMB4XDTI0MTExODAwMDAwMFoXDTI1MTEwNzIzNTk1OVowGzEZMBcGA1UEAxMQczMuYW1hem9uYXdzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMGXtc3i+g97RMURv3p1tSCKxTnUdTIfQM2z8WjC92XEkSFnIl95srB/eNy5OCvtzjn34fGOpYYgK16c1Cpach+MYURbht/JgMupGBmsEsID+2dLE4c7SDceU0yUqo/1r9L3fRcdsYs2OLKRQ8lZF3K6ivNHQoG3/0VzW8aKa83dd47YhplSOIw8nkpU63KKTW2GjG0A7F/ZYxJ1dJQ6h84unppFwycIhzUNdSZhrD5DWtl8Geh5dCww1xNgwYAmmXHfZa34cH2t+bqBEiJXR2IfCGaaKSHOZfYUJchZFNJa4Bje9zIb2pUm2iagwpYFXQGImQhojulqSN9UqKgUJ+cCAwEAAaOCBVkwggVVMB8GA1UdIwQYMBaAFIG4DmOKiRIY5fo7O1CVn+blkBOFMB0GA1UdDgQWBBThl2yTRVylV6xJH/pxp31THtCCZzCCAokGA1UdEQSCAoAwggJ8ghBzMy5hbWF6b25hd3MuY29tghIqLnMzLmFtYXpvbmF3cy5jb22CJiouczMuZHVhbHN0YWNrLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tgiRzMy5kdWFsc3RhY2sudXMtZWFzdC0xLmFtYXpvbmF3cy5jb22CHCouczMudXMtZWFzdC0xLmFtYXpvbmF3cy5jb22CGnMzLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tgiQqLnMzLWNvbnRyb2wudXMtZWFzdC0xLmFtYXpvbmF3cy5jb22CInMzLWNvbnRyb2wudXMtZWFzdC0xLmFtYXpvbmF3cy5jb22CLiouczMtY29udHJvbC5kdWFsc3RhY2sudXMtZWFzdC0xLmFtYXpvbmF3cy5jb22CLHMzLWNvbnRyb2wuZHVhbHN0YWNrLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tgigqLnMzLWFjY2Vzc3BvaW50LnVzLWVhc3QtMS5hbWF6b25hd3MuY29tgjIqLnMzLWFjY2Vzc3BvaW50LmR1YWxzdGFjay51cy1lYXN0LTEuYW1hem9uYXdzLmNvbYInKi5zMy1kZXByZWNhdGVkLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tgiVzMy1kZXByZWNhdGVkLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tghtzMy1leHRlcm5hbC0xLmFtYXpvbmF3cy5jb22CHSouczMtZXh0ZXJuYWwtMS5hbWF6b25hd3MuY29tghtzMy1leHRlcm5hbC0yLmFtYXpvbmF3cy5jb22CHSouczMtZXh0ZXJuYWwtMi5hbWF6b25hd3MuY29tMBMGA1UdIAQMMAowCAYGZ4EMAQIBMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwOwYDVR0fBDQwMjAwoC6gLIYqaHR0cDovL2NybC5yMm0wMS5hbWF6b250cnVzdC5jb20vcjJtMDEuY3JsMHUGCCsGAQUFBwEBBGkwZzAtBggrBgEFBQcwAYYhaHR0cDovL29jc3AucjJtMDEuYW1hem9udHJ1c3QuY29tMDYGCCsGAQUFBzAChipodHRwOi8vY3J0LnIybTAxLmFtYXpvbnRydXN0LmNvbS9yMm0wMS5jZXIwDAYDVR0TAQH/BAIwADCCAX4GCisGAQQB1nkCBAIEggFuBIIBagFoAHYAEvFONL1TckyEBhnDjz96E/jntWKHiJxtMAWE6+WGJjoAAAGTQIHVbAAABAMARzBFAiBYBQq6o1CtEw/NDrn0FmxpQzkCHg5hEeiNSDxqFb7YugIhAKr8P2Ua64Obt4Kp7JvT93aGBVyNG0zRATXbPXs7IteRAHUA5tIxY0B3jMEQQQbXcbnOwdJA9paEhvu6hzId/R43jlAAAAGTQIHVJQAABAMARjBEAiBvKVcrPsAr5hloptd0ba7TseDiz+TFlLkcppIu6Y2LtgIgPkbqULjBDM8VGQ5E6T+waMGgtGXtrOoKhxGamrWGOmAAdwDM+w9qhXEJZf6Vm1PO6bJ8IumFXA2XjbapflTA/kwNsAAAAZNAgdUOAAAEAwBIMEYCIQC3psaTzQ9+ld/rzlJM19qhByd2my1JJZqmqzIjesj3nAIhAOlkpk5a81kVwaBDiwfDsKPnI7JXZvXQziZvsMmjP1raMA0GCSqGSIb3DQEBCwUAA4IBAQDVWb8RpOO7jB8pyVtW2tXevgDS+VH+D2WO9PAYdc8CuEAFb5t/RKdkSlEmb6GLGewQi+uY31PP4YpKw7SOKGCMHhMlU1nxnAmtBcwVdeRXrfXRtwaRQ0DrJLYFkfmFctbMWLWYFMHya+LSu/lovjND+rk3wkDqQXqy5BwV0hynDebWDd5uzY05abSNS4lyAbx/nQT8ly3j/3FG1aYoytLxYMrsPTWOR915mjEoPCDpMgeZfBzYL0UuZNACMQg40Vb9OFsK2nY8q6C8urL5DMg254cDGLBPllRXaVL2w9kdWKMgy9rYrr0+2PomOcvDqL8SHxn0/w9bRzCloMGPsKiMEwEABAAAAAAAAQEAAAAAAAAEUDI1NgAAAA5SU0EtUFNTLVNIQTI1NgADZgoyJpFcT/u7IImFpjLfBb3Dl5pUIkzVhYlpa26W6oMAAAAAAAAIQDCCCDwwggckoAMCAQICEA/wls50Eia05zD92c8emlcwDQYJKoZIhvcNAQELBQAwPDELMAkGA1UEBhMCVVMxDzANBgNVBAoTBkFtYXpvbjEcMBoGA1UEAxMTQW1hem9uIFJTQSAyMDQ4IE0wMTAeFw0yNDExMTgwMDAwMDBaFw0yNTExMDcyMzU5NTlaMBsxGTAXBgNVBAMTEHMzLmFtYXpvbmF3cy5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDBl7XN4voPe0TFEb96dbUgisU51HUyH0DNs/FowvdlxJEhZyJfebKwf3jcuTgr7c459+HxjqWGICtenNQqWnIfjGFEW4bfyYDLqRgZrBLCA/tnSxOHO0g3HlNMlKqP9a/S930XHbGLNjiykUPJWRdyuorzR0KBt/9Fc1vGimvN3XeO2IaZUjiMPJ5KVOtyik1thoxtAOxf2WMSdXSUOofOLp6aRcMnCIc1DXUmYaw+Q1rZfBnoeXQsMNcTYMGAJplx32Wt+HB9rfm6gRIiV0diHwhmmikhzmX2FCXIWRTSWuAY3vcyG9qVJtomoMKWBV0BiJkIaI7pakjfVKioFCfnAgMBAAGjggVZMIIFVTAfBgNVHSMEGDAWgBSBuA5jiokSGOX6OztQlZ/m5ZAThTAdBgNVHQ4EFgQU4Zdsk0VcpVesSR/6cad9Ux7QgmcwggKJBgNVHREEggKAMIICfIIQczMuYW1hem9uYXdzLmNvbYISKi5zMy5hbWF6b25hd3MuY29tgiYqLnMzLmR1YWxzdGFjay51cy1lYXN0LTEuYW1hem9uYXdzLmNvbYIkczMuZHVhbHN0YWNrLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tghwqLnMzLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tghpzMy51cy1lYXN0LTEuYW1hem9uYXdzLmNvbYIkKi5zMy1jb250cm9sLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tgiJzMy1jb250cm9sLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tgi4qLnMzLWNvbnRyb2wuZHVhbHN0YWNrLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tgixzMy1jb250cm9sLmR1YWxzdGFjay51cy1lYXN0LTEuYW1hem9uYXdzLmNvbYIoKi5zMy1hY2Nlc3Nwb2ludC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbYIyKi5zMy1hY2Nlc3Nwb2ludC5kdWFsc3RhY2sudXMtZWFzdC0xLmFtYXpvbmF3cy5jb22CJyouczMtZGVwcmVjYXRlZC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbYIlczMtZGVwcmVjYXRlZC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbYIbczMtZXh0ZXJuYWwtMS5hbWF6b25hd3MuY29tgh0qLnMzLWV4dGVybmFsLTEuYW1hem9uYXdzLmNvbYIbczMtZXh0ZXJuYWwtMi5hbWF6b25hd3MuY29tgh0qLnMzLWV4dGVybmFsLTIuYW1hem9uYXdzLmNvbTATBgNVHSAEDDAKMAgGBmeBDAECATAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMDsGA1UdHwQ0MDIwMKAuoCyGKmh0dHA6Ly9jcmwucjJtMDEuYW1hem9udHJ1c3QuY29tL3IybTAxLmNybDB1BggrBgEFBQcBAQRpMGcwLQYIKwYBBQUHMAGGIWh0dHA6Ly9vY3NwLnIybTAxLmFtYXpvbnRydXN0LmNvbTA2BggrBgEFBQcwAoYqaHR0cDovL2NydC5yMm0wMS5hbWF6b250cnVzdC5jb20vcjJtMDEuY2VyMAwGA1UdEwEB/wQCMAAwggF+BgorBgEEAdZ5AgQCBIIBbgSCAWoBaAB2ABLxTjS9U3JMhAYZw48/ehP457Vih4icbTAFhOvlhiY6AAABk0CB1WwAAAQDAEcwRQIgWAUKuqNQrRMPzQ659BZsaUM5Ah4OYRHojUg8ahW+2LoCIQCq/D9lGuuDm7eCqeyb0/d2hgVcjRtM0QE12z17OyLXkQB1AObSMWNAd4zBEEEG13G5zsHSQPaWhIb7uocyHf0eN45QAAABk0CB1SUAAAQDAEYwRAIgbylXKz7AK+YZaKbXdG2u07Hg4s/kxZS5HKaSLumNi7YCID5G6lC4wQzPFRkOROk/sGjBoLRl7azqCocRmpq1hjpgAHcAzPsPaoVxCWX+lZtTzumyfCLphVwNl422qX5UwP5MDbAAAAGTQIHVDgAABAMASDBGAiEAt6bGk80PfpXf685STNfaoQcndpstSSWapqsyI3rI95wCIQDpZKZOWvNZFcGgQ4sHw7Cj5yOyV2b10M4mb7DJoz9a2jANBgkqhkiG9w0BAQsFAAOCAQEA1Vm/EaTju4wfKclbVtrV3r4A0vlR/g9ljvTwGHXPArhABW+bf0SnZEpRJm+hixnsEIvrmN9Tz+GKSsO0jihgjB4TJVNZ8ZwJrQXMFXXkV6310bcGkUNA6yS2BZH5hXLWzFi1mBTB8mvi0rv5aL4zQ/q5N8JA6kF6suQcFdIcpw3m1g3ebs2NOWm0jUuJcgG8f50E/Jct4/9xRtWmKMrS8WDK7D01jkfdeZoxKDwg6TIHmXwc2C9FLmTQAjEIONFW/ThbCtp2PKugvLqy+QzINueHAxiwT5ZUV2lS9sPZHVijIMva2K69Ptj6JjnLw6i/Eh8Z9P8PW0cwpaDBj7CojGYKMiaRXE/7uyCJhaYy3wW9w5eaVCJM1YWJaWtuluqDAAAAAAAABGIwggReMIIDRqADAgECAhMHcxI4C51miKM7Htm/nM2mjg4PMA0GCSqGSIb3DQEBCwUAMDkxCzAJBgNVBAYTAlVTMQ8wDQYDVQQKEwZBbWF6b24xGTAXBgNVBAMTEEFtYXpvbiBSb290IENBIDEwHhcNMjIwODIzMjIyMTI4WhcNMzAwODIzMjIyMTI4WjA8MQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRwwGgYDVQQDExNBbWF6b24gUlNBIDIwNDggTTAxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA63EsqcsfiCiSMjCvilcPeLc3JZVVh6xnXJfTIsjaohRna3zwZ9riAyqzVhJdxrVH+WcIp5N6lZIYD7T5+RA2mn8vgLZPuhNOx11THuDdljMHINOWvBLkdFBCoQUTc7VPm0Qk/i1/7bwihew2ITOXdQbOJxiC3OPZxYIHjV4mASYmZx/ZPxPPMrprrXhk/Kr/DgI8B9+cBXhyjP3qdbcDKITa6G4HjNBQhe+BVLJxbuxtYu+PlMNe6cSk0JHALiSRmMruuiWO1PZxtvtbazgGSDdHjYbc8uoG+3Y3fZ7/Qk5NWIKTz+JxwnixeqtLW5Q3iIHk2a8krvhyxWX7S7RR5wIDAQABo4IBWjCCAVYwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMB0GA1UdDgQWBBSBuA5jiokSGOX6OztQlZ/m5ZAThTAfBgNVHSMEGDAWgBSEGMyFNOy8DJSULghZnMeyEE4KCDB7BggrBgEFBQcBAQRvMG0wLwYIKwYBBQUHMAGGI2h0dHA6Ly9vY3NwLnJvb3RjYTEuYW1hem9udHJ1c3QuY29tMDoGCCsGAQUFBzAChi5odHRwOi8vY3J0LnJvb3RjYTEuYW1hem9udHJ1c3QuY29tL3Jvb3RjYTEuY2VyMD8GA1UdHwQ4MDYwNKAyoDCGLmh0dHA6Ly9jcmwucm9vdGNhMS5hbWF6b250cnVzdC5jb20vcm9vdGNhMS5jcmwwEwYDVR0gBAwwCjAIBgZngQwBAgEwDQYJKoZIhvcNAQELBQADggEBAK0A3gIFIy4GMmK0a7GUFuQRQN4r+lnBNe/gqo8rQbnR84c5AB3yPbWnRwwGBsaR8wdXAtTtvRfBkJq/SHWiB08w3UpqQrUNPRXAD/6EW8Y8mcxXUrHYbhLVlpKTS5TlB+iJgghqejTUnmThPYdqkpCaY6FL+I+26jTTBb4gwt4G4oyfc4ufTTmFys4ZNp2FyZ7J+FA/tn6Ioe/KhAaLULQKXKYcRPH9yGFAYPJhJaoH9MfCc3XkDAtCjQTlX0RImVt7iYGWp4idSw1i6ATE1/606LJtyuzAHLw4Wx3fhc5beuNJS2y5p930BbJJreHFFGvCzOvNf9ZYabrDIH5/sLhmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAANFMIIDQTCCAimgAwIBAgITBmyfz5m/jAo54vB4ikPmljZbyjANBgkqhkiG9w0BAQsFADA5MQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRkwFwYDVQQDExBBbWF6b24gUm9vdCBDQSAxMB4XDTE1MDUyNjAwMDAwMFoXDTM4MDExNzAwMDAwMFowOTELMAkGA1UEBhMCVVMxDzANBgNVBAoTBkFtYXpvbjEZMBcGA1UEAxMQQW1hem9uIFJvb3QgQ0EgMTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALJ4gHHKeNXjca9HgFB0fW7Y14h29Jlo91ghYPl0hAEvrAIthtOgQ3pOsqTQNroBvo3bSMgHFzZM9O6II8c+6zf1tRn4SWiw3te5djgdYZ6k/oI2peVKVuRF4fn9tBb6dNqcmzU5L/qwIFAGbHrQgLKm+a/sRxmPUDgH3KKHOVj4utWp+UhnMJbulHheb4mjUcAwhmahRWa6VOujw5H5SNz/0egwLX0tdHA114gk957EWW67c4cX8jJGKLhD+rcdqsq08p8kDi1L93FcXmn/6pUCyziKrlA4b9v7LWIbxcceVOF34GfID5yHI9Y/QCB/IIDEgEw+OyQmjgSubJrIqg0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNVHQ8BAf8EBAMCAYYwHQYDVR0OBBYEFIQYzIU07LwMlJQuCFmcx7IQTgoIMA0GCSqGSIb3DQEBCwUAA4IBAQCY8jdaQZChGsV2USggNiMOruYou6r4lK5IpDB/G/wkjUu0yKGX9rbxenDIU5PMCCjjmCXPI6T53iHTfIUJrU6adTrCC2qJeHZERxhlbI1Bjjt/msv0tadQ1wUsN+gDS63pYaACbvXy8MWy7Vu33PqUXHeeE6V/Uq2V8viTO96LXFvKWlJbYK8U90vvo/ufQJVtMVT8QtPHRh8jrdkPSHCa2XV4cdFyQzR1bldZwgJcJmApzyMZFo6IQ6XU5MsI+yMRQ+hDKXJioaldXgjUkK642M4UwtBV8ob2xJNDd2ZhwLnoQdeXeGADbkpyrqXRfboQnoZsG4q5WTP468SQvvG5AAAAAQAAAAhodHRwLzEuMQABAAAAAE50bHNmbGFnczB4MDAwMDAwMDA6czMuYW1hem9uYXdzLmNvbTo0NDNecGFydGl0aW9uS2V5PSUyOGh0dHBzJTJDaGVsc2lua2kuZmklMjkAAA== request-method GET response-head HTTP/1.1 200 OK
ETag: "caec25561cd7bffd0a2a7a9570c97ef9"
x-amz-server-side-encryption: AES256
Accept-Ranges: bytes
Content-Type: application/javascript; charset=utf-8
Content-Length: 53065
x-amz-id-2: HcfEEct4fOnfR13jhiR1HqupW/ixDMjK6g2VLmySJqoSi607hCZSBjNyHd+oE4DYuX4OGFIrQgg=
x-amz-request-id: KXFX10QAFM0HKNNM
Date: Wed, 15 Jan 2025 10:47:38 GMT
Last-Modified: Fri, 13 Dec 2024 18:06:56 GMT
Cache-Control: max-age=3600
Server: AmazonS3
 original-response-headers x-amz-id-2: LZzTaLvXy7HNHrU6MwbtImmxC/UA26PpEqh5ZBVFRoPDMVZA3h2kmlesnxH/qHqYe2EOrFfHA4l+48rFCaPOjmGnQ5nKkMwO
x-amz-request-id: JAKB0GCZ87S3G8EM
Date: Thu, 02 Jan 2025 14:36:19 GMT
Last-Modified: Fri, 13 Dec 2024 18:06:56 GMT
ETag: "caec25561cd7bffd0a2a7a9570c97ef9"
x-amz-server-side-encryption: AES256
Cache-Control: max-age=3600
Accept-Ranges: bytes
Content-Type: application/javascript; charset=utf-8
Content-Length: 53065
Server: AmazonS3
 ctid 2 uncompressed-len 0 net-response-time-onstart 880 net-response-time-onstop 1089 alt-data 1;53065,javascript/moz-script-bytecode-20241209150345-8l alt-data-from-child 1  h=